<!DOCTYPE html>
<html lang="en" class="scroll-smooth">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description"
        content="LootQuest - The #1 Platform to earn free Robux & V-Bucks. Instant payouts. No BS.">
    <title>LootQuest | Premium Gaming Rewards</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- GSAP & Plugins -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/ScrollTrigger.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/TextPlugin.min.js"></script>

    <!-- Google Fonts: Space Grotesk & Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Space+Grotesk:wght@500;700;800&display=swap"
        rel="stylesheet">

    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- i18n Translation Scripts -->
    <script src="/js/translations.js"></script>
    <script src="/js/language-manager.js"></script>

    <!-- LootAuth Module -->
    <script src="/js/auth.js"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        loot: {
                            black: '#050505',
                            dark: '#0a0a0a',
                            card: '#121212',
                            neon: '#00f3ff',     // Cyan
                            purple: '#bc13fe',   // Electric Purple
                            gold: '#ffd700',     // Loot Gold
                            text: '#e0e0e0',
                            dim: '#6b7280'
                        }
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        display: ['Space Grotesk', 'sans-serif'],
                    },
                    backgroundImage: {
                        'grid-pattern': "linear-gradient(to right, #1f1f1f 1px, transparent 1px), linear-gradient(to bottom, #1f1f1f 1px, transparent 1px)",
                        'hero-glow': "radial-gradient(circle at center, rgba(188, 19, 254, 0.15) 0%, transparent 70%)"
                    },
                    boxShadow: {
                        'neon': '0 0 20px rgba(0, 243, 255, 0.3)',
                        'purple': '0 0 20px rgba(188, 19, 254, 0.3)',
                    }
                }
            }
        }
    </script>

    <style>
        body {
            background-color: #050505;
            color: #e0e0e0;
            overflow-x: hidden;
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
        }

        ::-webkit-scrollbar-track {
            background: #0a0a0a;
        }

        ::-webkit-scrollbar-thumb {
            background: #333;
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #bc13fe;
        }

        /* Glassmorphism */
        .glass {
            background: rgba(18, 18, 18, 0.6);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .glass-card {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.03) 0%, rgba(255, 255, 255, 0.01) 100%);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.05);
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .glass-card:hover {
            border-color: rgba(0, 243, 255, 0.3);
            transform: translateY(-10px) scale(1.02);
            box-shadow: 0 10px 40px -10px rgba(0, 243, 255, 0.2);
        }

        /* Text Gradients */
        .text-gradient-primary {
            background: linear-gradient(135deg, #00f3ff 0%, #bc13fe 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .text-gradient-gold {
            background: linear-gradient(135deg, #ffd700 0%, #ff8c00 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        /* Neon Button */
        .btn-neon {
            position: relative;
            background: transparent;
            color: #00f3ff;
            border: 1px solid #00f3ff;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .btn-neon::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(0, 243, 255, 0.2), transparent);
            transition: 0.5s;
        }

        .btn-neon:hover::before {
            left: 100%;
        }

        .btn-neon:hover {
            background: rgba(0, 243, 255, 0.1);
            box-shadow: 0 0 20px rgba(0, 243, 255, 0.4);
            text-shadow: 0 0 8px rgba(0, 243, 255, 0.6);
        }

        .btn-glow {
            background: linear-gradient(135deg, #00f3ff 0%, #bc13fe 100%);
            color: white;
            position: relative;
            z-index: 1;
        }

        .btn-glow::after {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: linear-gradient(135deg, #00f3ff 0%, #bc13fe 100%);
            z-index: -1;
            filter: blur(15px);
            opacity: 0.5;
            transition: opacity 0.3s ease;
            border-radius: inherit;
        }

        .btn-glow:hover::after {
            opacity: 0.8;
            filter: blur(20px);
        }

        /* Animations */
        @keyframes float {

            0%,
            100% {
                transform: translateY(0px) rotate(0deg);
            }

            50% {
                transform: translateY(-20px) rotate(2deg);
            }
        }

        .animate-float {
            animation: float 6s ease-in-out infinite;
        }

        .animate-float-delayed {
            animation: float 8s ease-in-out infinite 1s;
        }

        .grid-bg {
            background-size: 40px 40px;
            mask-image: linear-gradient(to bottom, black 40%, transparent 100%);
        }

        /* Marquee */
        .marquee-container {
            overflow: hidden;
            white-space: nowrap;
            position: relative;
        }

        .marquee-content {
            display: inline-block;
            animation: marquee 30s linear infinite;
        }

        @keyframes marquee {
            0% {
                transform: translateX(0);
            }

            100% {
                transform: translateX(-50%);
            }
        }

        .marquee-container:hover .marquee-content {
            animation-play-state: paused;
        }

        /* Quest Line */
        .quest-line-path {
            stroke-dasharray: 1000;
            stroke-dashoffset: 1000;
        }
    </style>
</head>

<body class="antialiased selection:bg-loot-purple selection:text-white">

    <!-- Loading Overlay -->
    <div id="loader" class="fixed inset-0 z-50 bg-loot-black flex items-center justify-center">
        <div class="flex flex-col items-center">
            <h1 class="font-display text-4xl md:text-6xl font-bold tracking-tighter mb-4">
                LOOT<span class="text-gradient-primary">QUEST</span>
            </h1>
            <div class="w-48 h-1 bg-gray-800 rounded-full overflow-hidden">
                <div id="loader-bar" class="w-0 h-full bg-gradient-to-r from-loot-neon to-loot-purple"></div>
            </div>
            <p class="mt-2 font-mono text-loot-neon text-sm animate-pulse">INITIALIZING...</p>
        </div>
    </div>

    <!-- Background Elements -->
    <div class="fixed inset-0 z-[-1] bg-loot-black">
        <div class="absolute inset-0 bg-grid-pattern grid-bg opacity-[0.07]"></div>
        <div
            class="absolute top-0 left-1/2 -translate-x-1/2 w-full h-[800px] bg-hero-glow opacity-60 pointer-events-none">
        </div>
    </div>

    <!-- Floating Coins (Parallax) -->
    <div id="parallax-bg" class="fixed inset-0 z-[-1] overflow-hidden pointer-events-none opacity-40">
        <!-- Elements injected by JS -->
    </div>

    <!-- Navigation -->
    <nav class="fixed w-full z-40 top-0 transition-all duration-300" id="navbar">
        <div class="max-w-7xl mx-auto px-6 h-20 flex items-center justify-between">
            <!-- Logo -->
            <a href="#" class="font-display text-2xl font-bold tracking-tighter flex items-center gap-2 group">
                <i data-lucide="gamepad-2" class="text-loot-neon group-hover:rotate-12 transition-transform"></i>
                <span>LOOT<span class="text-gradient-primary">QUEST</span></span>
            </a>

            <!-- Desktop Menu -->
            <div class="hidden md:flex items-center gap-8">
                <a href="#how-it-works" class="text-sm font-medium text-gray-400 hover:text-white transition-colors">How
                    it Works</a>
                <a href="#rewards"
                    class="text-sm font-medium text-gray-400 hover:text-white transition-colors">Rewards</a>
                <a href="#stats" class="text-sm font-medium text-gray-400 hover:text-white transition-colors">Hall of
                    Fame</a>
            </div>

            <!-- CTA -->
            <div class="hidden md:flex items-center gap-4">
                <!-- Language Switcher -->
                <button id="lang-switcher" onclick="toggleLanguage()"
                    class="w-10 h-10 rounded-xl bg-white/5 hover:bg-white/10 flex items-center justify-center text-xl transition-all hover:scale-110"
                    title="Switch Language">
                    <span class="lang-flag">ðŸ‡ºðŸ‡¸</span>
                </button>

                <button onclick="loginWithGoogle()"
                    class="text-sm font-medium text-gray-300 hover:text-white transition-colors" data-i18n="nav_login">
                    Login
                </button>
                <button onclick="loginWithGoogle()"
                    class="btn-neon px-6 py-2 rounded-lg font-display font-bold text-sm uppercase tracking-wide"
                    data-i18n="hero_btn_start">
                    Start Quest
                </button>
            </div>

            <!-- Mobile Menu Btn -->
            <button class="md:hidden text-white">
                <i data-lucide="menu"></i>
            </button>
        </div>
    </nav>

    <!-- APP CONTAINER (SPA Logic Switch) -->
    <div id="app">

        <!-- ==================== LANDING PAGE ==================== -->
        <main id="landing-page" class="relative">

            <!-- HERO SECTION -->
            <section class="min-h-screen flex items-center justify-center pt-20 relative overflow-hidden">
                <div class="max-w-5xl mx-auto px-6 text-center relative z-10">

                    <!-- Badge -->
                    <div
                        class="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-loot-card border border-loot-purple/30 mb-8 hero-element opacity-0">
                        <span class="w-2 h-2 rounded-full bg-green-500 animate-pulse"></span>
                        <span class="text-xs font-mono text-loot-neon" data-i18n="live_payouts">LIVE PAYOUTS
                            ACTIVE</span>
                    </div>

                    <!-- Main Title -->
                    <h1
                        class="font-display text-5xl md:text-8xl font-bold leading-none tracking-tighter mb-6 hero-element opacity-0">
                        <span data-i18n="hero_line1">Your Time.</span> <br />
                        <span data-i18n="hero_line2">Your Skills.</span> <br />
                        <span class="text-gradient-primary" data-i18n="hero_line3">Your Loot.</span>
                    </h1>

                    <!-- Subtitle -->
                    <p class="text-lg md:text-xl text-gray-400 max-w-2xl mx-auto mb-10 hero-element opacity-0 font-light"
                        data-i18n="hero_desc">
                        The #1 Platform to earn free Robux & V-Bucks. Complete quests. Level up. Get paid instantly. No
                        BS.
                    </p>

                    <!-- CTAs -->
                    <div class="flex flex-col sm:flex-row items-center justify-center gap-4 hero-element opacity-0">
                        <button onclick="loginWithGoogle()"
                            class="btn-glow px-8 py-4 rounded-xl font-display font-bold text-lg w-full sm:w-auto hover:scale-105 transition-transform"
                            data-i18n="hero_btn_start">
                            START EARNING NOW
                        </button>
                        <button onclick="document.getElementById('how-it-works').scrollIntoView({behavior: 'smooth'})"
                            class="px-8 py-4 rounded-xl font-display font-bold text-lg w-full sm:w-auto text-gray-400 hover:text-white border border-gray-800 hover:border-gray-600 transition-all"
                            data-i18n="how_title">
                            HOW IT WORKS
                        </button>
                    </div>

                    <!-- Trust Indicators -->
                    <div class="mt-12 flex items-center justify-center gap-8 text-gray-500 hero-element opacity-0">
                        <div class="flex items-center gap-2">
                            <i data-lucide="shield-check" class="w-5 h-5 text-loot-purple"></i>
                            <span class="text-sm" data-i18n="hero_stat_rating">Verified Payouts</span>
                        </div>
                        <div class="flex items-center gap-2">
                            <i data-lucide="zap" class="w-5 h-5 text-loot-neon"></i>
                            <span class="text-sm" data-i18n="hero_stat_paid">Instant Delivery</span>
                        </div>
                        <div class="flex items-center gap-2">
                            <i data-lucide="globe" class="w-5 h-5 text-loot-gold"></i>
                            <span class="text-sm">Global Access</span>
                        </div>
                    </div>
                </div>
            </section>

            <!-- LIVE TICKER (Social Proof) -->
            <div class="w-full bg-loot-card border-y border-white/5 py-3 relative z-20">
                <div class="marquee-container">
                    <div class="marquee-content" id="payout-ticker">
                        <!-- JS injected items -->
                    </div>
                    <!-- Duplicate for infinite scroll -->
                    <div class="marquee-content" id="payout-ticker-dup">
                        <!-- JS injected items -->
                    </div>
                </div>
            </div>

            <!-- HOW IT WORKS (Gamified Timeline) -->
            <section id="how-it-works" class="py-32 relative">
                <div class="max-w-4xl mx-auto px-6">
                    <div class="text-center mb-24">
                        <h2 class="font-display text-4xl md:text-5xl font-bold mb-4" data-i18n="quest_log_title">Your
                            Quest Log</h2>
                        <p class="text-gray-400" data-i18n="quest_log_subtitle">Three simple steps to claim your bounty.
                        </p>
                    </div>

                    <div class="relative">
                        <!-- Progress Line -->
                        <div
                            class="absolute left-1/2 top-0 bottom-0 w-1 bg-gray-800 -translate-x-1/2 rounded-full hidden md:block">
                            <div id="timeline-fill"
                                class="w-full bg-gradient-to-b from-loot-neon to-loot-purple h-0 rounded-full"></div>
                        </div>

                        <!-- Step 1 -->
                        <div
                            class="timeline-step relative grid grid-cols-1 md:grid-cols-2 gap-8 md:gap-16 items-center mb-24">
                            <div class="md:text-right order-2 md:order-1">
                                <h3 class="font-display text-3xl font-bold text-loot-neon mb-2"
                                    data-i18n="quest_step1_title">1. The Login</h3>
                                <p class="text-gray-400" data-i18n="quest_step1_desc">Link your Google or Discord
                                    account. One click entry. No
                                    complex registration forms.</p>
                            </div>
                            <div
                                class="absolute left-1/2 -translate-x-1/2 w-12 h-12 bg-loot-black border-2 border-loot-neon rounded-full z-10 flex items-center justify-center hidden md:flex shadow-neon">
                                <i data-lucide="log-in" class="w-5 h-5 text-white"></i>
                            </div>
                            <div class="order-1 md:order-2">
                                <div class="glass-card p-6 rounded-2xl rotate-1 hover:rotate-0 transition-transform">
                                    <div class="text-xs font-mono text-gray-500 mb-2">// SYSTEM.ACCESS</div>
                                    <div class="flex items-center gap-3">
                                        <div
                                            class="w-10 h-10 rounded-full bg-indigo-500/20 flex items-center justify-center">
                                            <i data-lucide="gamepad-2" class="text-indigo-400"></i>
                                        </div>
                                        <div class="font-bold">Player Connected</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Step 2 -->
                        <div
                            class="timeline-step relative grid grid-cols-1 md:grid-cols-2 gap-8 md:gap-16 items-center mb-24">
                            <div class="order-2"> <!-- Image side -->
                                <div class="glass-card p-6 rounded-2xl -rotate-1 hover:rotate-0 transition-transform">
                                    <div class="text-xs font-mono text-gray-500 mb-2">// MISSION.LOG</div>
                                    <div class="space-y-3">
                                        <div class="flex justify-between items-center text-sm">
                                            <span>Survey: Cyber Security</span>
                                            <span class="text-loot-gold">+500 PTS</span>
                                        </div>
                                        <div class="w-full bg-gray-800 h-1.5 rounded-full overflow-hidden">
                                            <div class="bg-loot-gold w-3/4 h-full"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div
                                class="absolute left-1/2 -translate-x-1/2 w-12 h-12 bg-loot-black border-2 border-loot-purple rounded-full z-10 flex items-center justify-center hidden md:flex shadow-purple">
                                <i data-lucide="sword" class="w-5 h-5 text-white"></i>
                            </div>
                            <div class="order-1 md:order-3"> <!-- Text side -->
                                <h3 class="font-display text-3xl font-bold text-loot-purple mb-2"
                                    data-i18n="quest_step2_title">2. The Grind</h3>
                                <p class="text-gray-400" data-i18n="quest_step2_desc">Complete quests, surveys, and app
                                    downloads. Each mission
                                    grants XP (Points).</p>
                            </div>
                        </div>

                        <!-- Step 3 -->
                        <div
                            class="timeline-step relative grid grid-cols-1 md:grid-cols-2 gap-8 md:gap-16 items-center">
                            <div class="md:text-right order-2 md:order-1">
                                <h3 class="font-display text-3xl font-bold text-loot-gold mb-2"
                                    data-i18n="quest_step3_title">3. The Loot</h3>
                                <p class="text-gray-400" data-i18n="quest_step3_desc">Cash out instantly. Robux,
                                    V-Bucks, or PayPal. No waiting
                                    games.</p>
                            </div>
                            <div
                                class="absolute left-1/2 -translate-x-1/2 w-12 h-12 bg-loot-black border-2 border-loot-gold rounded-full z-10 flex items-center justify-center hidden md:flex shadow-lg shadow-yellow-500/20">
                                <i data-lucide="gem" class="w-5 h-5 text-white"></i>
                            </div>
                            <div class="order-1 md:order-2">
                                <div class="glass-card p-6 rounded-2xl rotate-2 hover:rotate-0 transition-transform">
                                    <div class="text-xs font-mono text-gray-500 mb-2">// TRANSACTION.COMPLETE</div>
                                    <div class="text-3xl font-bold text-white mb-1">1,000</div>
                                    <div class="text-sm text-loot-neon">ROBUX DELIVERED</div>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </section>

            <!-- REWARDS PREVIEW -->
            <section id="rewards" class="py-24 bg-gradient-to-b from-transparent to-loot-dark/50">
                <div class="max-w-7xl mx-auto px-6">
                    <h2 class="font-display text-4xl md:text-5xl font-bold mb-12 text-center">Featured <span
                            class="text-gradient-primary">Loot</span></h2>

                    <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                        <!-- Card 1 -->
                        <div class="glass-card p-1 rounded-3xl relative group">
                            <div class="absolute top-4 right-4 z-10">
                                <span class="flex h-3 w-3">
                                    <span
                                        class="animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75"></span>
                                    <span class="relative inline-flex rounded-full h-3 w-3 bg-green-500"></span>
                                </span>
                            </div>
                            <div
                                class="bg-loot-card/50 rounded-[22px] p-8 h-full flex flex-col items-center text-center">
                                <div
                                    class="w-32 h-32 mb-6 transform group-hover:scale-110 transition-transform duration-500 filter drop-shadow-[0_0_15px_rgba(255,255,255,0.2)]">
                                    <img src="https://upload.wikimedia.org/wikipedia/commons/c/c7/Robux_2019_Logo_gold.svg"
                                        alt="Robux" class="w-full h-full object-contain">
                                </div>
                                <h3 class="font-display text-2xl font-bold mb-2">Roblox Robux</h3>
                                <p class="text-gray-400 text-sm mb-6">The ultimate currency for Roblox.</p>
                                <button onclick="loginWithGoogle()"
                                    class="w-full btn-neon py-3 rounded-lg font-bold">CLAIM NOW</button>
                            </div>
                        </div>

                        <!-- Card 2 -->
                        <div class="glass-card p-1 rounded-3xl relative group border-loot-purple/50">
                            <div
                                class="absolute -inset-0.5 bg-gradient-to-r from-loot-neon to-loot-purple opacity-30 blur group-hover:opacity-60 transition duration-500 rounded-3xl">
                            </div>
                            <div class="absolute top-4 right-4 z-10">
                                <span class="flex h-3 w-3">
                                    <span
                                        class="animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75"></span>
                                    <span class="relative inline-flex rounded-full h-3 w-3 bg-green-500"></span>
                                </span>
                            </div>
                            <div
                                class="bg-loot-card rounded-[22px] p-8 h-full flex flex-col items-center text-center relative">
                                <div
                                    class="absolute top-0 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-loot-purple text-xs font-bold px-3 py-1 rounded-full border border-loot-black">
                                    POPULAR</div>
                                <div
                                    class="w-32 h-32 mb-6 transform group-hover:scale-110 transition-transform duration-500 filter drop-shadow-[0_0_15px_rgba(188,19,254,0.3)]">
                                    <img src="https://upload.wikimedia.org/wikipedia/commons/3/31/Epic_Games_logo.svg"
                                        alt="V-Bucks"
                                        class="w-full h-full object-contain p-4 invert bg-black/20 rounded-full">
                                </div>
                                <h3 class="font-display text-2xl font-bold mb-2">Fortnite V-Bucks</h3>
                                <p class="text-gray-400 text-sm mb-6">Skins, Battle Passes & Emotes.</p>
                                <button onclick="loginWithGoogle()"
                                    class="w-full btn-glow py-3 rounded-lg font-bold">CLAIM NOW</button>
                            </div>
                        </div>

                        <!-- Card 3 -->
                        <div class="glass-card p-1 rounded-3xl relative group">
                            <div class="absolute top-4 right-4 z-10">
                                <span class="flex h-3 w-3">
                                    <span
                                        class="animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75"></span>
                                    <span class="relative inline-flex rounded-full h-3 w-3 bg-green-500"></span>
                                </span>
                            </div>
                            <div
                                class="bg-loot-card/50 rounded-[22px] p-8 h-full flex flex-col items-center text-center">
                                <div
                                    class="w-32 h-32 mb-6 transform group-hover:scale-110 transition-transform duration-500 filter drop-shadow-[0_0_15px_rgba(0,112,186,0.2)]">
                                    <img src="https://upload.wikimedia.org/wikipedia/commons/b/b5/PayPal.svg"
                                        alt="PayPal" class="w-full h-full object-contain p-2">
                                </div>
                                <h3 class="font-display text-2xl font-bold mb-2">PayPal Cash</h3>
                                <p class="text-gray-400 text-sm mb-6">Real money directly to your account.</p>
                                <button onclick="loginWithGoogle()"
                                    class="w-full btn-neon py-3 rounded-lg font-bold">CLAIM NOW</button>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- TRUST FOOTER -->
            <footer class="relative z-10 mt-20 border-t border-white/5">
                <!-- Server Status Bar -->
                <div class="bg-loot-card/50 border-b border-white/5 py-3">
                    <div class="max-w-7xl mx-auto px-6 flex items-center justify-between text-sm">
                        <div id="server-status" class="flex items-center gap-2">
                            <span class="w-2 h-2 rounded-full bg-green-500 animate-pulse"></span>
                            <span class="text-gray-400">All Systems Operational</span>
                        </div>
                        <div class="flex items-center gap-4 text-gray-500">
                            <span class="flex items-center gap-1">
                                <i data-lucide="shield-check" class="w-4 h-4 text-loot-neon"></i>
                                SSL Secured
                            </span>
                            <span class="flex items-center gap-1">
                                <i data-lucide="lock" class="w-4 h-4 text-loot-purple"></i>
                                256-bit Encryption
                            </span>
                        </div>
                    </div>
                </div>

                <!-- Main Footer Content -->
                <div class="glass py-16">
                    <div class="max-w-7xl mx-auto px-6 grid grid-cols-1 md:grid-cols-5 gap-12">

                        <!-- Brand Column -->
                        <div class="col-span-1 md:col-span-2">
                            <a href="#"
                                class="font-display text-2xl font-bold tracking-tighter flex items-center gap-2 mb-4">
                                <i data-lucide="gamepad-2" class="text-loot-neon"></i>
                                <span>LOOT<span class="text-gradient-primary">QUEST</span></span>
                            </a>
                            <p class="text-gray-400 text-sm mb-6 max-w-xs">
                                The trusted platform for gamers to earn Robux, V-Bucks, and real rewards through simple
                                tasks.
                            </p>

                            <!-- Social Links with Glow -->
                            <div class="flex items-center gap-3">
                                <a href="https://discord.gg/lootquest" target="_blank" rel="noopener"
                                    class="w-10 h-10 rounded-xl bg-[#5865F2]/20 border border-[#5865F2]/30 flex items-center justify-center text-[#5865F2] hover:bg-[#5865F2] hover:text-white hover:shadow-[0_0_20px_rgba(88,101,242,0.5)] transition-all duration-300">
                                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                                        <path
                                            d="M20.317 4.37a19.791 19.791 0 0 0-4.885-1.515.074.074 0 0 0-.079.037c-.21.375-.444.864-.608 1.25a18.27 18.27 0 0 0-5.487 0 12.64 12.64 0 0 0-.617-1.25.077.077 0 0 0-.079-.037A19.736 19.736 0 0 0 3.677 4.37a.07.07 0 0 0-.032.027C.533 9.046-.32 13.58.099 18.057a.082.082 0 0 0 .031.057 19.9 19.9 0 0 0 5.993 3.03.078.078 0 0 0 .084-.028c.462-.63.874-1.295 1.226-1.994a.076.076 0 0 0-.041-.106 13.107 13.107 0 0 1-1.872-.892.077.077 0 0 1-.008-.128 10.2 10.2 0 0 0 .372-.292.074.074 0 0 1 .077-.01c3.928 1.793 8.18 1.793 12.062 0a.074.074 0 0 1 .078.01c.12.098.246.198.373.292a.077.077 0 0 1-.006.127 12.299 12.299 0 0 1-1.873.892.077.077 0 0 0-.041.107c.36.698.772 1.362 1.225 1.993a.076.076 0 0 0 .084.028 19.839 19.839 0 0 0 6.002-3.03.077.077 0 0 0 .032-.054c.5-5.177-.838-9.674-3.549-13.66a.061.061 0 0 0-.031-.03zM8.02 15.33c-1.183 0-2.157-1.085-2.157-2.419 0-1.333.956-2.419 2.157-2.419 1.21 0 2.176 1.096 2.157 2.42 0 1.333-.956 2.418-2.157 2.418zm7.975 0c-1.183 0-2.157-1.085-2.157-2.419 0-1.333.955-2.419 2.157-2.419 1.21 0 2.176 1.096 2.157 2.42 0 1.333-.946 2.418-2.157 2.418z" />
                                    </svg>
                                </a>
                                <a href="https://twitter.com/lootquest" target="_blank" rel="noopener"
                                    class="w-10 h-10 rounded-xl bg-white/5 border border-white/10 flex items-center justify-center text-gray-400 hover:bg-white hover:text-black hover:shadow-[0_0_20px_rgba(255,255,255,0.3)] transition-all duration-300">
                                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                                        <path
                                            d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z" />
                                    </svg>
                                </a>
                                <a href="https://youtube.com/@lootquest" target="_blank" rel="noopener"
                                    class="w-10 h-10 rounded-xl bg-red-500/10 border border-red-500/20 flex items-center justify-center text-red-500 hover:bg-red-500 hover:text-white hover:shadow-[0_0_20px_rgba(239,68,68,0.5)] transition-all duration-300">
                                    <i data-lucide="youtube" class="w-5 h-5"></i>
                                </a>
                            </div>
                        </div>

                        <!-- Quick Links -->
                        <div>
                            <h4 class="font-display font-bold text-white mb-4" data-i18n="footer_platform">Platform</h4>
                            <ul class="space-y-2 text-sm">
                                <li><a href="#how-it-works" class="text-gray-400 hover:text-loot-neon transition-colors"
                                        data-i18n="footer_how_works">How it Works</a>
                                </li>
                                <li><a href="#rewards" class="text-gray-400 hover:text-loot-neon transition-colors"
                                        data-i18n="footer_rewards">Rewards</a></li>
                                <li><a href="/blog" onclick="loadBlogPage(); return false;"
                                        class="text-gray-400 hover:text-loot-neon transition-colors"
                                        data-i18n="footer_blog">Blog</a></li>
                                <li><a href="#" onclick="openLegalModal('faq'); return false;"
                                        class="text-gray-400 hover:text-loot-neon transition-colors"
                                        data-i18n="footer_faq">FAQ</a>
                                </li>
                            </ul>
                        </div>

                        <!-- Support -->
                        <div>
                            <h4 class="font-display font-bold text-white mb-4" data-i18n="footer_support">Support</h4>
                            <ul class="space-y-2 text-sm">
                                <li><a href="#" onclick="openLegalModal('faq'); return false;"
                                        class="text-gray-400 hover:text-loot-neon transition-colors"
                                        data-i18n="footer_faq">FAQ</a></li>
                                <li><a href="#" onclick="openContactModal(); return false;"
                                        class="text-gray-400 hover:text-loot-neon transition-colors"
                                        data-i18n="footer_contact">Contact Us</a></li>
                                <li><a href="https://discord.gg/lootquest" target="_blank"
                                        class="text-gray-400 hover:text-loot-neon transition-colors"
                                        data-i18n="footer_discord">Discord
                                        Community</a></li>
                                <li><a href="#" onclick="openBugModal(); return false;"
                                        class="text-gray-400 hover:text-loot-neon transition-colors"
                                        data-i18n="footer_bug">Report a
                                        Bug</a></li>
                            </ul>
                        </div>

                        <!-- Legal -->
                        <div>
                            <h4 class="font-display font-bold text-white mb-4" data-i18n="footer_legal">Legal</h4>
                            <ul class="space-y-2 text-sm">
                                <li><a href="#" onclick="openLegalModal('terms-of-service'); return false;"
                                        class="text-gray-400 hover:text-loot-neon transition-colors"
                                        data-i18n="footer_terms">Terms of
                                        Service</a></li>
                                <li><a href="#" onclick="openLegalModal('privacy-policy'); return false;"
                                        class="text-gray-400 hover:text-loot-neon transition-colors"
                                        data-i18n="footer_privacy">Privacy Policy</a>
                                </li>
                                <li><a href="#" onclick="openLegalModal('cookie-policy'); return false;"
                                        class="text-gray-400 hover:text-loot-neon transition-colors"
                                        data-i18n="footer_cookies">Cookie Policy</a>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Bottom Bar -->
                <div class="bg-loot-black py-4 border-t border-white/5">
                    <div
                        class="max-w-7xl mx-auto px-6 flex flex-col md:flex-row items-center justify-between gap-4 text-sm text-gray-500">
                        <p>&copy; <span id="copyright-year"></span> LootQuest. All rights reserved.</p>
                        <div class="flex items-center gap-4">
                            <span class="flex items-center gap-1">
                                <i data-lucide="globe" class="w-4 h-4"></i>
                                English (US)
                            </span>
                        </div>
                    </div>
                </div>
            </footer>
        </main>

        <!-- ==================== DASHBOARD (Hidden by default) ==================== -->
        <main id="dashboard" class="hidden min-h-screen pt-24 px-6 max-w-7xl mx-auto">
            <div class="text-center py-20">
                <h2 class="text-3xl font-display font-bold mb-4">Welcome back, <span id="user-name-display"
                        class="text-loot-neon">Gamer</span></h2>
                <div class="glass-card p-8 rounded-2xl max-w-md mx-auto">
                    <p class="text-gray-400 mb-2">Current Balance</p>
                    <div class="text-5xl font-bold text-white mb-2" id="dash-balance">0</div>
                    <div class="text-loot-gold font-mono text-sm">LOOT POINTS AVAILABLE</div>
                </div>

                <div class="grid grid-cols-2 gap-4 max-w-md mx-auto mt-8">
                    <button class="glass-card p-6 rounded-xl hover:bg-loot-card/80 flex flex-col items-center gap-3">
                        <i data-lucide="sword" class="w-8 h-8 text-loot-purple"></i>
                        <span class="font-bold">Offers</span>
                    </button>
                    <button class="glass-card p-6 rounded-xl hover:bg-loot-card/80 flex flex-col items-center gap-3">
                        <i data-lucide="gift" class="w-8 h-8 text-loot-neon"></i>
                        <span class="font-bold">Redeem</span>
                    </button>
                </div>

                <button onclick="logout()" class="mt-8 text-gray-500 hover:text-white text-sm">
                    <i data-lucide="log-out" class="w-4 h-4 inline mr-1"></i> Logout
                </button>
            </div>
        </main>

    </div>

    <!-- ==================== AUTH MODAL ==================== -->
    <div id="auth-modal" class="fixed inset-0 z-50 hidden">
        <!-- Backdrop -->
        <div class="absolute inset-0 bg-black/80 backdrop-blur-sm" onclick="closeAuthModal()"></div>

        <!-- Modal Content -->
        <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-full max-w-md p-4">
            <div class="glass-card rounded-3xl p-8 border border-white/10">
                <!-- Close Button -->
                <button onclick="closeAuthModal()" class="absolute top-4 right-4 text-gray-500 hover:text-white">
                    <i data-lucide="x" class="w-6 h-6"></i>
                </button>

                <!-- Logo -->
                <div class="text-center mb-6">
                    <h2 class="font-display text-2xl font-bold">
                        LOOT<span class="text-gradient-primary">QUEST</span>
                    </h2>
                    <p class="text-gray-500 text-sm mt-1">Join the quest. Earn rewards.</p>
                </div>

                <!-- Tabs -->
                <div class="flex bg-loot-card rounded-xl p-1 mb-6">
                    <button id="tab-login" onclick="switchAuthTab('login')"
                        class="flex-1 py-2 rounded-lg text-sm font-bold transition-all bg-loot-purple text-white">
                        Login
                    </button>
                    <button id="tab-register" onclick="switchAuthTab('register')"
                        class="flex-1 py-2 rounded-lg text-sm font-bold transition-all text-gray-400 hover:text-white">
                        Register
                    </button>
                </div>

                <!-- Login Form -->
                <form id="form-login" onsubmit="handleEmailLogin(event)" class="space-y-4">
                    <div>
                        <label class="block text-sm text-gray-400 mb-1">Email</label>
                        <input type="email" id="login-email" required
                            class="w-full bg-loot-card border border-white/10 rounded-xl px-4 py-3 text-white placeholder-gray-500 focus:outline-none focus:border-loot-neon transition-colors"
                            placeholder="gamer@example.com">
                    </div>
                    <div>
                        <label class="block text-sm text-gray-400 mb-1">Password</label>
                        <input type="password" id="login-password" required
                            class="w-full bg-loot-card border border-white/10 rounded-xl px-4 py-3 text-white placeholder-gray-500 focus:outline-none focus:border-loot-neon transition-colors"
                            placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢">
                    </div>
                    <button type="submit" id="login-submit-btn"
                        class="w-full btn-glow py-3 rounded-xl font-bold text-lg">
                        LOGIN
                    </button>
                </form>

                <!-- Register Form -->
                <form id="form-register" onsubmit="handleEmailRegister(event)" class="space-y-4 hidden">
                    <div>
                        <label class="block text-sm text-gray-400 mb-1">Pseudo / Display Name *</label>
                        <input type="text" id="register-name" required minlength="3" maxlength="20"
                            class="w-full bg-loot-card border border-white/10 rounded-xl px-4 py-3 text-white placeholder-gray-500 focus:outline-none focus:border-loot-neon transition-colors"
                            placeholder="xX_ProGamer_Xx">
                    </div>
                    <div>
                        <label class="block text-sm text-gray-400 mb-1">Email *</label>
                        <input type="email" id="register-email" required
                            class="w-full bg-loot-card border border-white/10 rounded-xl px-4 py-3 text-white placeholder-gray-500 focus:outline-none focus:border-loot-neon transition-colors"
                            placeholder="gamer@example.com">
                    </div>
                    <div>
                        <label class="block text-sm text-gray-400 mb-1">Password (min 6 chars) *</label>
                        <input type="password" id="register-password" required minlength="6"
                            class="w-full bg-loot-card border border-white/10 rounded-xl px-4 py-3 text-white placeholder-gray-500 focus:outline-none focus:border-loot-neon transition-colors"
                            placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢">
                    </div>
                    <button type="submit" id="register-submit-btn"
                        class="w-full btn-glow py-3 rounded-xl font-bold text-lg">
                        CREATE ACCOUNT
                    </button>
                </form>

                <!-- Divider -->
                <div class="flex items-center gap-4 my-6">
                    <div class="flex-1 h-px bg-white/10"></div>
                    <span class="text-gray-500 text-sm">or continue with</span>
                    <div class="flex-1 h-px bg-white/10"></div>
                </div>

                <!-- OAuth Buttons -->
                <div class="grid grid-cols-2 gap-3">
                    <button onclick="handleGoogleLogin()"
                        class="flex items-center justify-center gap-2 bg-white text-black py-3 rounded-xl font-bold hover:bg-gray-200 transition-colors">
                        <svg class="w-5 h-5" viewBox="0 0 24 24">
                            <path fill="currentColor"
                                d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" />
                            <path fill="#34A853"
                                d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" />
                            <path fill="#FBBC05"
                                d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" />
                            <path fill="#EA4335"
                                d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" />
                        </svg>
                        Google
                    </button>
                    <button onclick="handleDiscordLogin()"
                        class="flex items-center justify-center gap-2 bg-[#5865F2] text-white py-3 rounded-xl font-bold hover:bg-[#4752C4] transition-colors">
                        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                            <path
                                d="M20.317 4.37a19.791 19.791 0 0 0-4.885-1.515.074.074 0 0 0-.079.037c-.21.375-.444.864-.608 1.25a18.27 18.27 0 0 0-5.487 0 12.64 12.64 0 0 0-.617-1.25.077.077 0 0 0-.079-.037A19.736 19.736 0 0 0 3.677 4.37a.07.07 0 0 0-.032.027C.533 9.046-.32 13.58.099 18.057a.082.082 0 0 0 .031.057 19.9 19.9 0 0 0 5.993 3.03.078.078 0 0 0 .084-.028 14.09 14.09 0 0 0 1.226-1.994.076.076 0 0 0-.041-.106 13.107 13.107 0 0 1-1.872-.892.077.077 0 0 1-.008-.128 10.2 10.2 0 0 0 .372-.292.074.074 0 0 1 .077-.01c3.928 1.793 8.18 1.793 12.062 0a.074.074 0 0 1 .078.01c.12.098.246.198.373.292a.077.077 0 0 1-.006.127 12.299 12.299 0 0 1-1.873.892.077.077 0 0 0-.041.107c.36.698.772 1.362 1.225 1.993a.076.076 0 0 0 .084.028 19.839 19.839 0 0 0 6.002-3.03.077.077 0 0 0 .032-.054c.5-5.177-.838-9.674-3.549-13.66a.061.061 0 0 0-.031-.03zM8.02 15.33c-1.183 0-2.157-1.085-2.157-2.419 0-1.333.956-2.419 2.157-2.419 1.21 0 2.176 1.096 2.157 2.42 0 1.333-.956 2.418-2.157 2.418zm7.975 0c-1.183 0-2.157-1.085-2.157-2.419 0-1.333.955-2.419 2.157-2.419 1.21 0 2.176 1.096 2.157 2.42 0 1.333-.946 2.418-2.157 2.418z" />
                        </svg>
                        Discord
                    </button>
                </div>

                <!-- Error Message -->
                <div id="auth-error"
                    class="hidden mt-4 p-3 bg-red-500/20 border border-red-500/50 rounded-xl text-red-400 text-sm text-center">
                </div>
            </div>
        </div>
    </div>

    <!-- ==================== BUG REPORT MODAL ==================== -->
    <div id="bug-report-modal" class="fixed inset-0 z-50 hidden">
        <!-- Backdrop -->
        <div class="absolute inset-0 bg-black/80 backdrop-blur-sm" onclick="closeBugReportModal()"></div>

        <!-- Modal Content -->
        <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-full max-w-lg p-4">
            <div class="glass-card rounded-3xl p-8 border border-white/10">
                <!-- Close Button -->
                <button onclick="closeBugReportModal()" class="absolute top-4 right-4 text-gray-500 hover:text-white">
                    <i data-lucide="x" class="w-6 h-6"></i>
                </button>

                <!-- Header -->
                <div class="flex items-center gap-3 mb-6">
                    <div class="w-12 h-12 rounded-xl bg-red-500/20 flex items-center justify-center">
                        <i data-lucide="bug" class="w-6 h-6 text-red-500"></i>
                    </div>
                    <div>
                        <h2 class="font-display text-xl font-bold">Report a Bug</h2>
                        <p class="text-gray-500 text-sm">Help us improve LootQuest</p>
                    </div>
                </div>

                <!-- Form -->
                <form id="bug-report-form" onsubmit="submitBugReport(event)" class="space-y-4">
                    <div>
                        <label class="block text-sm text-gray-400 mb-1">Category</label>
                        <select id="report-category" required
                            class="w-full bg-loot-card border border-white/10 rounded-xl px-4 py-3 text-white focus:outline-none focus:border-loot-neon transition-colors">
                            <option value="">Select a category</option>
                            <option value="ui">UI / Display Issue</option>
                            <option value="offers">Offers not crediting</option>
                            <option value="withdrawal">Withdrawal problem</option>
                            <option value="login">Login / Account issue</option>
                            <option value="performance">Performance / Loading</option>
                            <option value="other">Other</option>
                        </select>
                    </div>

                    <div>
                        <label class="block text-sm text-gray-400 mb-1">Title</label>
                        <input type="text" id="report-title" required minlength="5" maxlength="200"
                            class="w-full bg-loot-card border border-white/10 rounded-xl px-4 py-3 text-white placeholder-gray-500 focus:outline-none focus:border-loot-neon transition-colors"
                            placeholder="Brief description of the issue">
                    </div>

                    <div>
                        <label class="block text-sm text-gray-400 mb-1">Description</label>
                        <textarea id="report-description" required minlength="20" maxlength="5000" rows="4"
                            class="w-full bg-loot-card border border-white/10 rounded-xl px-4 py-3 text-white placeholder-gray-500 focus:outline-none focus:border-loot-neon transition-colors resize-none"
                            placeholder="Explain what happened, what you expected, and steps to reproduce..."></textarea>
                    </div>

                    <div>
                        <label class="block text-sm text-gray-400 mb-1">Your Email (optional)</label>
                        <input type="email" id="report-email"
                            class="w-full bg-loot-card border border-white/10 rounded-xl px-4 py-3 text-white placeholder-gray-500 focus:outline-none focus:border-loot-neon transition-colors"
                            placeholder="For follow-up (if not logged in)">
                    </div>

                    <button type="submit"
                        class="w-full btn-glow py-3 rounded-xl font-bold text-lg flex items-center justify-center gap-2">
                        <i data-lucide="send" class="w-5 h-5"></i>
                        Submit Report
                    </button>
                </form>

                <!-- Success Message -->
                <div id="report-success" class="hidden text-center py-8">
                    <div class="w-16 h-16 rounded-full bg-green-500/20 flex items-center justify-center mx-auto mb-4">
                        <i data-lucide="check-circle" class="w-8 h-8 text-green-500"></i>
                    </div>
                    <h3 class="font-display text-xl font-bold mb-2">Thank You!</h3>
                    <p class="text-gray-400 mb-6">Your bug report has been submitted. We'll look into it.</p>
                    <button onclick="closeBugReportModal()" class="text-loot-neon hover:underline">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ==================== ADMIN PANEL (Hidden page) ==================== -->
    <div id="admin-panel" class="fixed inset-0 z-50 hidden bg-loot-black overflow-auto">
        <div class="max-w-7xl mx-auto px-6 py-8">
            <!-- Header -->
            <div class="flex items-center justify-between mb-8">
                <div class="flex items-center gap-4">
                    <button onclick="closeAdminPanel()" class="text-gray-400 hover:text-white">
                        <i data-lucide="arrow-left" class="w-6 h-6"></i>
                    </button>
                    <h1 class="font-display text-3xl font-bold">Admin <span class="text-gradient-primary">Panel</span>
                    </h1>
                </div>
                <div class="flex items-center gap-2 text-sm text-gray-400">
                    <i data-lucide="shield-check" class="w-4 h-4 text-loot-neon"></i>
                    Authenticated
                </div>
            </div>

            <!-- Stats Grid -->
            <div id="admin-stats" class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
                <!-- Stats injected by JS -->
            </div>

            <!-- Tabs -->
            <div class="flex gap-2 mb-6">
                <button onclick="loadAdminReports('all')"
                    class="admin-tab active px-4 py-2 rounded-lg bg-loot-purple text-white font-medium">
                    All Reports
                </button>
                <button onclick="loadAdminReports('new')"
                    class="admin-tab px-4 py-2 rounded-lg bg-loot-card text-gray-400 font-medium hover:text-white">
                    New
                </button>
                <button onclick="loadAdminReports('in_progress')"
                    class="admin-tab px-4 py-2 rounded-lg bg-loot-card text-gray-400 font-medium hover:text-white">
                    In Progress
                </button>
                <button onclick="loadAdminReports('resolved')"
                    class="admin-tab px-4 py-2 rounded-lg bg-loot-card text-gray-400 font-medium hover:text-white">
                    Resolved
                </button>
            </div>

            <!-- Reports Table -->
            <div class="glass-card rounded-2xl overflow-hidden">
                <table class="w-full">
                    <thead class="bg-loot-card/50 border-b border-white/10">
                        <tr>
                            <th class="text-left px-6 py-4 text-sm font-medium text-gray-400">ID</th>
                            <th class="text-left px-6 py-4 text-sm font-medium text-gray-400">Category</th>
                            <th class="text-left px-6 py-4 text-sm font-medium text-gray-400">Title</th>
                            <th class="text-left px-6 py-4 text-sm font-medium text-gray-400">User</th>
                            <th class="text-left px-6 py-4 text-sm font-medium text-gray-400">Status</th>
                            <th class="text-left px-6 py-4 text-sm font-medium text-gray-400">Date</th>
                            <th class="text-left px-6 py-4 text-sm font-medium text-gray-400">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="admin-reports-table">
                        <!-- Reports injected by JS -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- ==================== UNIVERSAL DYNAMIC MODAL ==================== -->
    <div id="dynamic-modal" class="fixed inset-0 z-[100] hidden">
        <!-- Backdrop with blur -->
        <div id="modal-backdrop"
            class="absolute inset-0 bg-black/80 backdrop-blur-md transition-opacity duration-300 opacity-0"></div>

        <!-- Modal Container -->
        <div class="absolute inset-0 flex items-center justify-center p-4 overflow-auto">
            <div id="modal-content"
                class="relative w-full max-w-2xl transform transition-all duration-300 scale-95 opacity-0">
                <!-- Glassmorphism Card -->
                <div
                    class="glass-card rounded-3xl border border-white/20 shadow-2xl shadow-loot-purple/20 overflow-hidden">
                    <!-- Header -->
                    <div id="modal-header"
                        class="flex items-center justify-between px-8 py-5 border-b border-white/10 bg-gradient-to-r from-loot-purple/10 to-transparent">
                        <div class="flex items-center gap-3">
                            <div id="modal-icon"
                                class="w-10 h-10 rounded-xl bg-loot-purple/20 flex items-center justify-center">
                                <i data-lucide="info" class="w-5 h-5 text-loot-neon"></i>
                            </div>
                            <h2 id="modal-title" class="font-display text-xl font-bold text-white">Modal Title</h2>
                        </div>
                        <button onclick="closeModal()"
                            class="w-10 h-10 rounded-xl bg-white/5 hover:bg-white/10 flex items-center justify-center text-gray-400 hover:text-white transition-all">
                            <i data-lucide="x" class="w-5 h-5"></i>
                        </button>
                    </div>

                    <!-- Body (scrollable with custom scrollbar) -->
                    <div id="modal-body" class="px-8 py-6 max-h-[70vh] overflow-y-auto custom-scrollbar">
                        <!-- Content injected dynamically -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <style>
        /* Custom Scrollbar for Modals */
        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
        }

        .custom-scrollbar::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 3px;
        }

        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, #A855F7, #00D9FF);
            border-radius: 3px;
        }

        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(180deg, #9333EA, #00B8D9);
        }

        /* Modal Animation Classes */
        #dynamic-modal.active #modal-backdrop {
            opacity: 1;
        }

        #dynamic-modal.active #modal-content {
            transform: scale(1);
            opacity: 1;
        }

        /* Legal Content Styling */
        .legal-content h3 {
            font-size: 1.25rem;
            font-weight: 700;
            color: #fff;
            margin-top: 1.5rem;
            margin-bottom: 0.75rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .legal-content p {
            color: #9CA3AF;
            margin-bottom: 1rem;
            line-height: 1.7;
        }

        .legal-content ul {
            list-style: disc;
            padding-left: 1.5rem;
            color: #9CA3AF;
            margin-bottom: 1rem;
        }

        .legal-content li {
            margin-bottom: 0.5rem;
        }

        .legal-content strong {
            color: #fff;
        }

        .legal-content .warning-box {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.3);
            border-radius: 0.75rem;
            padding: 1rem;
            margin: 1rem 0;
        }

        .legal-content .warning-box p {
            color: #FCA5A5;
            margin: 0;
        }
    </style>

    <!-- Scripts -->
    <script>
        // Initialize Icons
        lucide.createIcons();

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• STATE â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        let currentUser = null;
        let authToken = localStorage.getItem('lootquest_token');

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• GSAP ANIMATIONS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        window.addEventListener('load', async () => {
            const tl = gsap.timeline();

            tl.to("#loader-bar", { width: "100%", duration: 1.5, ease: "power2.inOut" })
                .to("#loader", { opacity: 0, duration: 0.5, onComplete: () => document.getElementById('loader').style.display = 'none' })
                .to(".hero-element", {
                    y: 0,
                    opacity: 1,
                    duration: 0.8,
                    stagger: 0.2,
                    ease: "back.out(1.7)"
                });

            initParallax();

            // Check for existing session
            if (authToken) {
                await checkAuthSession();
            }
        });

        function initParallax() {
            const container = document.getElementById('parallax-bg');
            const colors = ['#00f3ff', '#bc13fe', '#ffd700'];

            for (let i = 0; i < 15; i++) {
                const el = document.createElement('div');
                const size = Math.random() * 50 + 10;

                el.style.width = `${size}px`;
                el.style.height = `${size}px`;
                el.style.position = 'absolute';
                el.style.left = `${Math.random() * 100}%`;
                el.style.top = `${Math.random() * 100}%`;
                el.style.opacity = Math.random() * 0.1 + 0.02;
                el.style.background = colors[Math.floor(Math.random() * colors.length)];
                el.style.borderRadius = Math.random() > 0.5 ? '50%' : '10%';

                container.appendChild(el);

                gsap.to(el, {
                    y: Math.random() * 200 - 100,
                    x: Math.random() * 200 - 100,
                    rotation: Math.random() * 360,
                    duration: Math.random() * 10 + 10,
                    repeat: -1,
                    yoyo: true,
                    ease: "sine.inOut"
                });
            }
        }

        gsap.registerPlugin(ScrollTrigger);

        gsap.to("#timeline-fill", {
            height: "100%",
            scrollTrigger: {
                trigger: "#how-it-works",
                start: "top center",
                end: "bottom center",
                scrub: true
            }
        });

        gsap.utils.toArray('.timeline-step').forEach((step, i) => {
            gsap.from(step, {
                opacity: 0,
                y: 50,
                duration: 0.8,
                scrollTrigger: {
                    trigger: step,
                    start: "top 80%",
                    toggleActions: "play none none reverse"
                }
            });
        });

        window.addEventListener('scroll', () => {
            const nav = document.getElementById('navbar');
            if (window.scrollY > 50) {
                nav.classList.add('glass', 'bg-black/50');
            } else {
                nav.classList.remove('glass', 'bg-black/50');
            }
        });

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• PAYOUT TICKER â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        const recentWins = [
            { user: "xX_Slayer_Xx", amount: "1,000 Robux" },
            { user: "FortniteGod", amount: "2,800 V-Bucks" },
            { user: "SarahP", amount: "$10 PayPal" },
            { user: "NoobMaster69", amount: "400 Robux" },
            { user: "ProGamer", amount: "$50 Steam" },
            { user: "LootKing", amount: "13,500 V-Bucks" },
            { user: "MinecraftSteve", amount: "$20 Amazon" },
        ];

        const tickerHtml = recentWins.map(win => `
            <div class="inline-flex items-center gap-3 mx-8 py-1">
                <div class="w-2 h-2 rounded-full bg-green-500 animate-pulse"></div>
                <span class="font-bold text-gray-300">${win.user}</span>
                <span class="text-gray-500 text-sm">withdrew</span>
                <span class="font-bold text-loot-neon">${win.amount}</span>
            </div>
        `).join('');

        document.getElementById('payout-ticker').innerHTML = tickerHtml;
        document.getElementById('payout-ticker-dup').innerHTML = tickerHtml;

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• AUTH MODAL â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        function openAuthModal() {
            document.getElementById('auth-modal').classList.remove('hidden');
            document.body.style.overflow = 'hidden';
            lucide.createIcons();
        }

        function closeAuthModal() {
            document.getElementById('auth-modal').classList.add('hidden');
            document.body.style.overflow = '';
            hideAuthError();
        }

        function switchAuthTab(tab) {
            const loginTab = document.getElementById('tab-login');
            const registerTab = document.getElementById('tab-register');
            const loginForm = document.getElementById('form-login');
            const registerForm = document.getElementById('form-register');

            if (tab === 'login') {
                loginTab.classList.add('bg-loot-purple', 'text-white');
                loginTab.classList.remove('text-gray-400');
                registerTab.classList.remove('bg-loot-purple', 'text-white');
                registerTab.classList.add('text-gray-400');
                loginForm.classList.remove('hidden');
                registerForm.classList.add('hidden');
            } else {
                registerTab.classList.add('bg-loot-purple', 'text-white');
                registerTab.classList.remove('text-gray-400');
                loginTab.classList.remove('bg-loot-purple', 'text-white');
                loginTab.classList.add('text-gray-400');
                registerForm.classList.remove('hidden');
                loginForm.classList.add('hidden');
            }
            hideAuthError();
        }

        function showAuthError(message) {
            const errorEl = document.getElementById('auth-error');
            errorEl.textContent = message;
            errorEl.classList.remove('hidden');
        }

        function hideAuthError() {
            document.getElementById('auth-error').classList.add('hidden');
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• EMAIL/PASSWORD AUTH â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        async function handleEmailLogin(e) {
            e.preventDefault();
            hideAuthError();

            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;

            try {
                // Initialize Firebase if needed
                if (!initFirebase()) {
                    showAuthError('Firebase initialization failed');
                    return;
                }

                // Sign in with Firebase Auth first
                const userCredential = await firebase.auth().signInWithEmailAndPassword(email, password);
                const user = userCredential.user;

                // Get Firebase ID token
                const idToken = await user.getIdToken();

                // Send token to backend for session creation
                const res = await fetch('/api/auth/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    credentials: 'include',
                    body: JSON.stringify({ idToken })
                });

                const data = await res.json();

                if (!data.success) {
                    // Handle EMAIL_NOT_VERIFIED error
                    if (data.error === 'EMAIL_NOT_VERIFIED') {
                        showEmailNotVerifiedError(email, user);
                        return;
                    }
                    showAuthError(data.error || 'Login failed');
                    return;
                }

                // Success - redirect to dashboard
                closeAuthModal();
                window.location.href = data.redirectUrl || '/dashboard.html';

            } catch (error) {
                console.error('Login error:', error);

                // Handle Firebase-specific errors
                if (error.code === 'auth/user-not-found') {
                    showAuthError('No account found with this email.');
                } else if (error.code === 'auth/wrong-password') {
                    showAuthError('Incorrect password. Try again.');
                } else if (error.code === 'auth/too-many-requests') {
                    showAuthError('Too many failed attempts. Please try again later.');
                } else if (error.code === 'auth/invalid-email') {
                    showAuthError('Invalid email address format.');
                } else {
                    showAuthError(error.message || 'Login failed');
                }
            }
        }

        // Show special error for unverified email with resend option
        function showEmailNotVerifiedError(email, firebaseUser) {
            const errorEl = document.getElementById('auth-error');
            errorEl.innerHTML = `
                <div class="text-left">
                    <p class="font-medium mb-2">âš ï¸ Email Not Verified</p>
                    <p class="text-sm text-gray-400 mb-3">
                        Please verify your email before logging in. Check your inbox for the verification link.
                    </p>
                    <button onclick="resendFromLogin()" id="resend-login-btn"
                        class="w-full py-2 rounded-lg bg-loot-neon/20 text-loot-neon text-sm font-medium hover:bg-loot-neon/30 transition-colors">
                        Resend Verification Email
                    </button>
                </div>
            `;
            errorEl.classList.remove('hidden');

            // Store user reference for resend
            window._unverifiedUser = firebaseUser;
        }

        async function resendFromLogin() {
            const btn = document.getElementById('resend-login-btn');
            if (!btn) return;

            try {
                btn.disabled = true;
                btn.textContent = 'Sending...';

                if (window._unverifiedUser) {
                    await window._unverifiedUser.sendEmailVerification();
                    btn.textContent = 'âœ“ Email Sent!';
                    btn.classList.remove('bg-loot-neon/20', 'text-loot-neon');
                    btn.classList.add('bg-green-500/20', 'text-green-400');
                    showToast('Verification email sent!', 'success');
                } else {
                    showToast('Please log in again to resend', 'error');
                }

                setTimeout(() => {
                    btn.disabled = false;
                    btn.textContent = 'Resend Verification Email';
                    btn.classList.remove('bg-green-500/20', 'text-green-400');
                    btn.classList.add('bg-loot-neon/20', 'text-loot-neon');
                }, 30000); // 30s cooldown

            } catch (error) {
                console.error('Resend error:', error);
                btn.disabled = false;
                btn.textContent = 'Resend Verification Email';
                showToast('Failed to send. Try again.', 'error');
            }
        }

        async function handleEmailRegister(e) {
            e.preventDefault();
            hideAuthError();

            const displayName = document.getElementById('register-name').value;
            const email = document.getElementById('register-email').value;
            const password = document.getElementById('register-password').value;

            try {
                // Initialize Firebase if needed
                if (!initFirebase()) {
                    showAuthError('Firebase initialization failed');
                    return;
                }

                // Create user with Firebase Auth
                const userCredential = await firebase.auth().createUserWithEmailAndPassword(email, password);
                const user = userCredential.user;

                // Update display name
                if (displayName) {
                    await user.updateProfile({ displayName: displayName });
                }

                // Send email verification
                await user.sendEmailVerification();
                console.log(`ðŸ“§ Verification email sent to: ${email}`);

                // Show verification modal instead of redirecting
                closeAuthModal();
                showEmailVerificationModal(email);

            } catch (error) {
                console.error('Registration error:', error);

                // Handle Firebase-specific errors
                if (error.code === 'auth/email-already-in-use') {
                    showAuthError('This email is already registered. Try logging in instead.');
                } else if (error.code === 'auth/weak-password') {
                    showAuthError('Password is too weak. Use at least 6 characters.');
                } else if (error.code === 'auth/invalid-email') {
                    showAuthError('Invalid email address format.');
                } else {
                    showAuthError(error.message || 'Registration failed');
                }
            }
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• EMAIL VERIFICATION MODAL â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        function showEmailVerificationModal(email) {
            const existingModal = document.getElementById('email-verification-modal');
            if (existingModal) existingModal.remove();

            const modal = document.createElement('div');
            modal.id = 'email-verification-modal';
            modal.className = 'fixed inset-0 z-50 flex items-center justify-center';
            modal.innerHTML = `
                <div class="absolute inset-0 bg-black/80 backdrop-blur-sm"></div>
                <div class="relative glass-card rounded-3xl p-8 max-w-md mx-4 border border-white/10 text-center">
                    <div class="w-20 h-20 rounded-full bg-loot-neon/20 flex items-center justify-center mx-auto mb-6">
                        <i data-lucide="mail-check" class="w-10 h-10 text-loot-neon"></i>
                    </div>
                    <h2 class="font-display text-2xl font-bold mb-2">Verify Your Email</h2>
                    <p class="text-gray-400 mb-6">
                        We've sent a verification link to:<br>
                        <span class="text-white font-medium">${email}</span>
                    </p>
                    <p class="text-sm text-gray-500 mb-6">
                        Click the link in the email to activate your account, then come back here to log in.
                    </p>
                    
                    <div class="space-y-3">
                        <button onclick="closeEmailVerificationModal()" class="w-full btn-glow py-3 rounded-xl font-bold">
                            GOT IT, LET ME LOG IN
                        </button>
                        <button onclick="resendVerificationEmail('${email}')" 
                            id="resend-btn"
                            class="w-full py-3 rounded-xl font-medium text-gray-400 hover:text-white border border-gray-700 hover:border-gray-500 transition-all">
                            Resend Verification Email
                        </button>
                    </div>
                    
                    <p class="text-xs text-gray-600 mt-4">
                        Didn't receive it? Check your spam folder.
                    </p>
                </div>
            `;
            document.body.appendChild(modal);
            document.body.style.overflow = 'hidden';
            lucide.createIcons();
        }

        function closeEmailVerificationModal() {
            const modal = document.getElementById('email-verification-modal');
            if (modal) {
                modal.remove();
                document.body.style.overflow = '';
                // Open login form
                openAuthModal();
                switchAuthTab('login');
            }
        }

        async function resendVerificationEmail(email) {
            const btn = document.getElementById('resend-btn');
            if (!btn) return;

            try {
                btn.disabled = true;
                btn.textContent = 'Sending...';

                const user = firebase.auth().currentUser;
                if (user) {
                    await user.sendEmailVerification();
                    btn.textContent = 'âœ“ Email Sent!';
                    btn.classList.add('text-green-400');
                    showToast('Verification email sent!', 'success');
                } else {
                    // User not logged in, need to sign in first to resend
                    showToast('Please try registering again', 'error');
                }

                setTimeout(() => {
                    btn.disabled = false;
                    btn.textContent = 'Resend Verification Email';
                    btn.classList.remove('text-green-400');
                }, 30000); // 30s cooldown

            } catch (error) {
                console.error('Resend error:', error);
                btn.disabled = false;
                btn.textContent = 'Resend Verification Email';
                showToast('Failed to send email. Try again later.', 'error');
            }
        }

        async function checkAuthSession() {
            try {
                const res = await fetch('/api/auth/me', {
                    headers: { 'Authorization': 'Bearer ' + authToken }
                });

                const data = await res.json();

                if (data.success) {
                    currentUser = data.user;
                    showDashboard();
                } else {
                    // Token invalid, clear it
                    localStorage.removeItem('lootquest_token');
                    authToken = null;
                }
            } catch (error) {
                console.error('Session check failed:', error);
            }
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• OAUTH CALLBACK HANDLER â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        async function handleOAuthCallback() {
            // Check for token in URL (from Discord OAuth callback)
            const urlParams = new URLSearchParams(window.location.search);
            const token = urlParams.get('token');
            const provider = urlParams.get('provider');
            const error = urlParams.get('error');

            // Handle OAuth errors
            if (error) {
                const errorMessages = {
                    'discord_denied': 'Discord login was cancelled',
                    'no_code': 'Authorization code missing',
                    'token_exchange_failed': 'Failed to authenticate with Discord',
                    'user_fetch_failed': 'Failed to get Discord profile',
                    'email_required': 'Discord email is required. Enable it in your Discord privacy settings.',
                    'auth_failed': 'Authentication failed. Please try again.'
                };
                showToast(errorMessages[error] || 'Login failed', 'error');
                // Clean URL
                window.history.replaceState({}, document.title, '/');
                return;
            }

            // Handle successful OAuth login
            if (token) {
                authToken = token;
                localStorage.setItem('lootquest_token', token);

                // Clean URL (remove token from address bar)
                window.history.replaceState({}, document.title, '/');

                // Fetch user info
                try {
                    const res = await fetch('/api/auth/me', {
                        headers: { 'Authorization': 'Bearer ' + token }
                    });

                    const data = await res.json();

                    if (data.success) {
                        currentUser = data.user;
                        showDashboard();
                        showToast(`Welcome${provider === 'discord' ? ' via Discord' : ''}, ${currentUser.displayName}!`, 'success');
                    } else {
                        localStorage.removeItem('lootquest_token');
                        showToast('Session expired. Please login again.', 'error');
                    }
                } catch (error) {
                    console.error('OAuth session check failed:', error);
                    showToast('Connection error', 'error');
                }
            }
        }

        // Run on page load
        handleOAuthCallback();

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• OAUTH (Firebase) â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        const firebaseConfig = {
            apiKey: "AIzaSyD9zEcBcCgQqANbN38EpbA9xy_3MITTCPM",
            authDomain: "loot-quest-5fe77.firebaseapp.com",
            projectId: "loot-quest-5fe77",
            storageBucket: "loot-quest-5fe77.firebasestorage.app",
            messagingSenderId: "1017089658126",
            appId: "1:1017089658126:web:95e79a3723a19003ea5b5f"
        };

        // Lazy initialization flag
        let firebaseInitialized = false;

        function initFirebase() {
            console.log("ðŸ”µ [DEBUG] initFirebase() called, initialized:", firebaseInitialized);

            if (firebaseInitialized) {
                console.log("âœ… [DEBUG] Firebase already initialized");
                return true;
            }

            if (typeof firebase === 'undefined') {
                console.error('âŒ [ERROR] Firebase SDK not loaded');
                return false;
            }

            try {
                console.log("ðŸ”µ [DEBUG] Calling firebase.initializeApp() with config:", {
                    authDomain: firebaseConfig.authDomain,
                    projectId: firebaseConfig.projectId
                });
                firebase.initializeApp(firebaseConfig);
                firebaseInitialized = true;
                console.log('âœ… [SUCCESS] Firebase initialized successfully!');
                console.log('ðŸ”¥ Firebase app name:', firebase.app().name);
                return true;
            } catch (e) {
                // Already initialized
                if (e.code === 'app/duplicate-app') {
                    firebaseInitialized = true;
                    console.log('âš ï¸ [WARN] Firebase already initialized (duplicate app)');
                    return true;
                }
                console.error('âŒ [ERROR] Firebase init error:', e);
                console.error('ðŸ“‹ Error details:', {
                    code: e.code,
                    message: e.message
                });
                return false;
            }
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• AUTO-REDIRECT AUTHENTICATED USERS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        // Initialize Firebase early and set up auth state listener
        if (typeof firebase !== 'undefined') {
            initFirebase();

            // Listen for authentication state changes
            firebase.auth().onAuthStateChanged(async (user) => {
                console.log('ðŸ” Auth state changed:', user ? `User: ${user.email}` : 'No user');

                if (user) {
                    // User is signed in
                    const emailVerified = user.emailVerified;
                    const provider = user.providerData[0]?.providerId;

                    console.log(`ðŸ“§ Email verified: ${emailVerified}, Provider: ${provider}`);

                    // Only redirect if email is verified OR it's a trusted provider (Google/Discord)
                    if (emailVerified || provider === 'google.com' || provider === 'discord.com') {
                        console.log('âœ… User is authenticated and verified, redirecting to dashboard...');
                        // Add small delay to avoid flash of content
                        setTimeout(() => {
                            window.location.href = '/dashboard.html';
                        }, 100);
                    } else {
                        console.log('âš ï¸ User exists but email not verified');
                        // User is logged in but email not verified - stay on landing page
                    }
                } else {
                    // User is signed out - stay on landing page
                    console.log('â„¹ï¸ No authenticated user, showing landing page');
                }
            });
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // GOOGLE AUTHENTICATION - CLEAN IMPLEMENTATION (Gold Standard)
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        /**
         * Google Sign-In Handler
         * Handles popup, token retrieval, and backend session creation
         */
        async function handleGoogleSignIn() {
            console.log('ðŸ”µ [DEBUG] Starting Google Sign-In...');
            console.log('ðŸ”µ [DEBUG] Firebase initialized:', firebaseInitialized);

            try {
                // 1. Create Google Auth Provider
                const provider = new firebase.auth.GoogleAuthProvider();
                provider.addScope('email');
                provider.addScope('profile');
                console.log('ðŸ”µ [DEBUG] Google provider created with scopes');

                // 2. Open Google Sign-In Popup
                console.log('ðŸ“± [DEBUG] Opening Google popup...');
                const result = await firebase.auth().signInWithPopup(provider);

                console.log('âœ… [SUCCESS] Popup successful!');
                console.log('ðŸ“§ [DEBUG] User email:', result.user.email);
                console.log('ðŸ”‘ [DEBUG] User UID:', result.user.uid);
                console.log('âœ”ï¸ [DEBUG] Email verified:', result.user.emailVerified);

                // 3. Get Firebase ID Token
                console.log('ðŸ”µ [DEBUG] Requesting ID token...');
                const idToken = await result.user.getIdToken();
                console.log('âœ… [SUCCESS] Got ID token (length:', idToken.length, ')');

                // 4. Send token to backend for session creation
                console.log('ðŸ“¤ [DEBUG] Sending token to backend /api/auth/login...');
                const response = await fetch('/api/auth/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    credentials: 'include', // CRITICAL for cookies
                    body: JSON.stringify({ idToken })
                });

                console.log('ðŸ“¥ [DEBUG] Backend response status:', response.status);
                const data = await response.json();
                console.log('ðŸ“¦ [DEBUG] Backend response data:', data);

                if (data.success) {
                    console.log('âœ… [SUCCESS] Backend session created!');
                    console.log('ðŸ‘¤ [DEBUG] User data:', data.user);

                    // 5. EXPLICIT REDIRECT to dashboard
                    console.log('ðŸš€ [DEBUG] Redirecting to /dashboard.html...');

                    // Close modal if open
                    closeModal();

                    // Force explicit redirect
                    window.location.href = '/dashboard.html';
                } else {
                    throw new Error(data.error || 'Backend session creation failed');
                }

            } catch (error) {
                console.error('âŒ [ERROR] Google Sign-In Error:', error);
                console.error('ðŸ“‹ [ERROR] Error code:', error.code);
                console.error('ðŸ“‹ [ERROR] Error message:', error.message);

                // Handle specific Firebase errors
                if (error.code === 'auth/popup-blocked') {
                    showToast('âŒ Popup bloquÃ© par votre navigateur. Activez les popups et rÃ©essayez.', 'error');
                } else if (error.code === 'auth/popup-closed-by-user') {
                    console.log('â„¹ï¸ [INFO] User closed the popup intentionally');
                    // Don't show error, user cancelled intentionally - but log for debugging
                    showToast('Connexion annulÃ©e', 'info');
                } else if (error.code === 'auth/cancelled-popup-request') {
                    console.log('â„¹ï¸ [INFO] Popup request cancelled (another one opened)');
                } else if (error.code === 'auth/unauthorized-domain') {
                    showToast('âŒ Domaine non autorisÃ©. Contactez le support.', 'error');
                } else if (error.code === 'auth/network-request-failed') {
                    showToast('âŒ Erreur rÃ©seau. VÃ©rifiez votre connexion internet.', 'error');
                } else {
                    showToast('âŒ Erreur de connexion: ' + (error.message || 'Unknown error'), 'error');
                }
            }
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• AUTH MODAL â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        function openAuthModal() {
            const content = `
                <div class="space-y-4">
                    <button onclick="handleGoogleSignIn()" class="w-full flex items-center justify-center gap-3 px-6 py-4 bg-white hover:bg-gray-50 text-gray-700 font-bold rounded-xl transition-all hover:scale-[1.02] hover:shadow-lg group">
                        <svg class="w-6 h-6" viewBox="0 0 24 24">
                            <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                            <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                            <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                            <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
                        </svg>
                        <span>Continue with Google</span>
                    </button>

                    <button onclick="loginWithDiscord()" class="w-full flex items-center justify-center gap-3 px-6 py-4 bg-[#5865F2] hover:bg-[#4752C4] text-white font-bold rounded-xl transition-all hover:scale-[1.02] hover:shadow-lg hover:shadow-[#5865F2]/20">
                        <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M20.317 4.37a19.791 19.791 0 0 0-4.885-1.515.074.074 0 0 0-.079.037c-.21.375-.444.864-.608 1.25a18.27 18.27 0 0 0-5.487 0 12.64 12.64 0 0 0-.617-1.25.077.077 0 0 0-.079-.037A19.736 19.736 0 0 0 3.677 4.37a.07.07 0 0 0-.032.027C.533 9.046-.32 13.58.099 18.057a.082.082 0 0 0 .031.057 19.9 19.9 0 0 0 5.993 3.03.078.078 0 0 0 .084-.028c.462-.63.874-1.295 1.226-1.994a.076.076 0 0 0-.041-.106 13.107 13.107 0 0 1-1.872-.892.077.077 0 0 1-.008-.128 10.2 10.2 0 0 0 .372-.292.074.074 0 0 1 .077-.01c3.928 1.793 8.18 1.793 12.062 0a.074.074 0 0 1 .078.01c.12.098.246.198.373.292a.077.077 0 0 1-.006.127 12.299 12.299 0 0 1-1.873.892.077.077 0 0 0-.041.107c.36.698.772 1.362 1.225 1.993a.076.076 0 0 0 .084.028 19.839 19.839 0 0 0 6.002-3.03.077.077 0 0 0 .032-.054c.5-5.177-.838-9.674-3.549-13.66a.061.061 0 0 0-.031-.03z"/>
                        </svg>
                        <span>Continue with Discord</span>
                    </button>

                    <div class="relative py-4">
                        <div class="absolute inset-0 flex items-center">
                            <div class="w-full border-t border-white/10"></div>
                        </div>
                        <div class="relative flex justify-center">
                            <span class="bg-loot-card px-4 text-sm text-gray-500">or with email</span>
                        </div>
                    </div>

                    <button onclick="openEmailAuthModal()" class="w-full flex items-center justify-center gap-3 px-6 py-4 bg-white/5 hover:bg-white/10 text-white font-bold rounded-xl border border-white/10 transition-all hover:scale-[1.02]">
                        <i data-lucide="mail" class="w-5 h-5"></i>
                        <span>Continue with Email</span>
                    </button>
                    
                     <p class="text-center text-xs text-gray-500 mt-4">
                        By logging in, you agree to our <a href="#" onclick="openLegalModal('terms-of-service'); return false;" class="text-loot-neon hover:underline">Terms</a> and <a href="#" onclick="openLegalModal('privacy-policy'); return false;" class="text-loot-neon hover:underline">Privacy Policy</a>.
                    </p>
                </div>
            `;

            openModal('Log In / Sign Up', content, 'log-in', 'text-loot-neon');
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• EMAIL AUTH LOGIC â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        function openEmailAuthModal(mode = 'login') {
            const content = `
                <div class="flex gap-4 mb-6 border-b border-white/10">
                    <button onclick="switchEmailTab('login')" id="dyn-tab-login" class="pb-2 text-lg font-bold border-b-2 ${mode === 'login' ? 'border-loot-neon text-white' : 'border-transparent text-gray-500'} transition-colors w-1/2">Login</button>
                    <button onclick="switchEmailTab('register')" id="dyn-tab-register" class="pb-2 text-lg font-bold border-b-2 ${mode === 'register' ? 'border-loot-neon text-white' : 'border-transparent text-gray-500'} transition-colors w-1/2">Register</button>
                </div>

                <!-- LOGIN FORM -->
                <form id="dyn-email-login-form" class="${mode === 'login' ? '' : 'hidden'} space-y-4" onsubmit="return false;">
                    <div>
                        <label class="block text-sm text-gray-400 mb-2">Email</label>
                        <input type="email" id="dyn-login-email" required class="w-full bg-loot-card border border-white/10 rounded-xl px-4 py-3 text-white focus:border-loot-neon focus:outline-none placeholder-gray-600">
                    </div>
                    <div>
                        <label class="block text-sm text-gray-400 mb-2">Password</label>
                        <input type="password" id="dyn-login-password" required class="w-full bg-loot-card border border-white/10 rounded-xl px-4 py-3 text-white focus:border-loot-neon focus:outline-none placeholder-gray-600">
                    </div>
                    <button onclick="handleEmailLogin()" id="dyn-login-submit-btn" class="w-full btn-glow py-3 rounded-xl font-bold text-lg bt-shine">Log In</button>
                    <div class="text-center">
                        <a href="#" onclick="alert('Please contact support to reset password'); return false;" class="text-sm text-gray-500 hover:text-white">Forgot Password?</a>
                    </div>
                </form>

                <!-- REGISTER FORM -->
                <form id="dyn-email-register-form" class="${mode === 'register' ? '' : 'hidden'} space-y-4" onsubmit="return false;">
                    <div>
                        <label class="block text-sm text-gray-400 mb-2">Pseudo / Display Name *</label>
                        <input type="text" id="dyn-register-name" required minlength="3" maxlength="20" class="w-full bg-loot-card border border-white/10 rounded-xl px-4 py-3 text-white focus:border-loot-neon focus:outline-none placeholder-gray-600" placeholder="xX_ProGamer_Xx">
                    </div>
                    <div>
                        <label class="block text-sm text-gray-400 mb-2">Email *</label>
                        <input type="email" id="dyn-register-email" required class="w-full bg-loot-card border border-white/10 rounded-xl px-4 py-3 text-white focus:border-loot-neon focus:outline-none placeholder-gray-600">
                    </div>
                    <div>
                        <label class="block text-sm text-gray-400 mb-2">Password (min 6 chars) *</label>
                        <input type="password" id="dyn-register-password" required minlength="6" class="w-full bg-loot-card border border-white/10 rounded-xl px-4 py-3 text-white focus:border-loot-neon focus:outline-none placeholder-gray-600">
                    </div>
                    <button onclick="handleEmailRegister()" id="dyn-register-submit-btn" class="w-full btn-neon py-3 rounded-xl font-bold text-lg">Create Account</button>
                </form>

                 <div class="mt-6 pt-6 border-t border-white/10 text-center">
                    <button onclick="openAuthModal()" class="text-sm text-gray-400 hover:text-white flex items-center justify-center gap-2 mx-auto">
                        <i data-lucide="arrow-left" class="w-4 h-4"></i> Back to options
                    </button>
                </div>
            `;
            openModal(mode === 'login' ? 'Welcome Back' : 'Join the Quest', content, 'mail', 'text-loot-neon');
        }

        function switchEmailTab(tab) {
            // Support both static and dynamic modal IDs
            const loginForm = document.getElementById('dyn-email-login-form') || document.getElementById('email-login-form');
            const registerForm = document.getElementById('dyn-email-register-form') || document.getElementById('email-register-form');
            const btnLogin = document.getElementById('dyn-tab-login') || document.getElementById('tab-login');
            const btnRegister = document.getElementById('dyn-tab-register') || document.getElementById('tab-register');

            if (loginForm) loginForm.classList.toggle('hidden', tab !== 'login');
            if (registerForm) registerForm.classList.toggle('hidden', tab !== 'register');

            if (tab === 'login') {
                if (btnLogin) {
                    btnLogin.classList.add('border-loot-neon', 'text-white');
                    btnLogin.classList.remove('border-transparent', 'text-gray-500');
                }
                if (btnRegister) {
                    btnRegister.classList.remove('border-loot-neon', 'text-white');
                    btnRegister.classList.add('border-transparent', 'text-gray-500');
                }
            } else {
                if (btnRegister) {
                    btnRegister.classList.add('border-loot-neon', 'text-white');
                    btnRegister.classList.remove('border-transparent', 'text-gray-500');
                }
                if (btnLogin) {
                    btnLogin.classList.remove('border-loot-neon', 'text-white');
                    btnLogin.classList.add('border-transparent', 'text-gray-500');
                }
            }
        }

        async function handleEmailLogin() {
            // Support both dynamic (dyn-*) and static modal IDs
            const email = (document.getElementById('dyn-login-email') || document.getElementById('login-email'))?.value || '';
            const password = (document.getElementById('dyn-login-password') || document.getElementById('login-password'))?.value || '';
            const submitBtn = document.getElementById('dyn-login-submit-btn') || document.getElementById('login-submit-btn');

            if (!email || !password) {
                showToast('Veuillez remplir tous les champs', 'error');
                return;
            }

            console.log('ðŸ”µ [DEBUG] Email login attempt for:', email);

            try {
                const result = await firebase.auth().signInWithEmailAndPassword(email, password);
                const user = result.user;

                console.log('ðŸ“§ [DEBUG] Login successful, checking email verification...');
                console.log('âœ”ï¸ [DEBUG] Email verified:', user.emailVerified);

                // EMAIL VERIFICATION GATE
                if (!user.emailVerified) {
                    console.log('âš ï¸ [WARN] Email not verified, blocking access');

                    // Sign out the user immediately
                    await firebase.auth().signOut();

                    // Show verification required modal
                    showEmailVerificationRequired(email);
                    return;
                }

                // Email verified - proceed with login
                console.log('âœ… [SUCCESS] Email verified, proceeding with login');
                await processAuthResult(user);

            } catch (error) {
                console.error('âŒ [ERROR] Login error:', error);

                // Better error messages in French
                let errorMessage = error.message;
                if (error.code === 'auth/user-not-found') {
                    errorMessage = 'Aucun compte trouvÃ© avec cet email';
                } else if (error.code === 'auth/wrong-password') {
                    errorMessage = 'Mot de passe incorrect';
                } else if (error.code === 'auth/invalid-email') {
                    errorMessage = 'Email invalide';
                } else if (error.code === 'auth/user-disabled') {
                    errorMessage = 'Ce compte a Ã©tÃ© dÃ©sactivÃ©';
                }

                showToast(errorMessage, 'error');
            }
        }

        async function handleEmailRegister() {
            // Support both dynamic (dyn-*) and static modal IDs
            const displayName = (document.getElementById('dyn-register-name') || document.getElementById('register-name'))?.value || '';
            const email = (document.getElementById('dyn-register-email') || document.getElementById('register-email'))?.value || '';
            const password = (document.getElementById('dyn-register-password') || document.getElementById('register-password'))?.value || '';
            const submitBtn = document.getElementById('dyn-register-submit-btn') || document.getElementById('register-submit-btn');

            // Validation
            if (!displayName || displayName.length < 3) {
                showToast('Le pseudo doit contenir au moins 3 caractÃ¨res', 'error');
                return;
            }

            if (!email || !password) {
                showToast('Veuillez remplir tous les champs', 'error');
                return;
            }

            if (password.length < 6) {
                showToast('Le mot de passe doit contenir au moins 6 caractÃ¨res', 'error');
                return;
            }

            // Disable button
            if (submitBtn) {
                submitBtn.disabled = true;
                submitBtn.textContent = 'CrÃ©ation en cours...';
            }

            console.log('ðŸ”µ [DEBUG] Email registration attempt for:', email, 'with display name:', displayName);

            try {
                // 1. Create the user account
                const result = await firebase.auth().createUserWithEmailAndPassword(email, password);
                const user = result.user;

                console.log('âœ… [SUCCESS] User account created:', user.uid);

                // 2. Update the profile with display name
                await user.updateProfile({ displayName: displayName });
                console.log('âœ… [SUCCESS] Profile updated with displayName:', displayName);

                // 3. Send email verification  
                await user.sendEmailVerification();
                console.log('ðŸ“§ [SUCCESS] Verification email sent to:', email);

                // 4. Sign out the user immediately (EMAIL VERIFICATION GATE)
                await firebase.auth().signOut();
                console.log('ðŸ”’ [DEBUG] User signed out - must verify email before login');

                // 5. Redirect to check-email page
                window.location.href = '/check-email.html?email=' + encodeURIComponent(email);

            } catch (error) {
                console.error('âŒ [ERROR] Registration error:', error);

                // Better error messages in French
                let errorMessage = error.message;
                if (error.code === 'auth/email-already-in-use') {
                    errorMessage = 'Cet email est dÃ©jÃ  utilisÃ©';
                } else if (error.code === 'auth/invalid-email') {
                    errorMessage = 'Email invalide';
                } else if (error.code === 'auth/weak-password') {
                    errorMessage = 'Mot de passe trop faible';
                }

                showToast(errorMessage, 'error');
            } finally {
                // Re-enable button
                if (submitBtn) {
                    submitBtn.disabled = false;
                    submitBtn.textContent = 'Create Account';
                }
            }
        }

        async function processAuthResult(user) {
            console.log('âœ… Auth successful:', user.email);
            showToast('Authentication successful...', 'success');

            try {
                const idToken = await user.getIdToken();
                const response = await fetch('/api/auth/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    credentials: 'include',
                    body: JSON.stringify({ idToken })
                });

                const data = await response.json();

                if (data.success) {
                    window.location.href = data.redirectUrl || '/dashboard.html';
                } else {
                    showToast(data.error || 'Login failed', 'error');
                }
            } catch (e) {
                console.error('Session creation failed:', e);
                showToast('Session creation failed', 'error');
            }
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• EMAIL VERIFICATION HELPERS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        /**
         * Show modal after successful registration
         * User must verify their email before logging in
         */
        function showEmailVerificationModal(email) {
            const content = `
                <div class="text-center py-6">
                    <div class="w-20 h-20 rounded-full bg-loot-neon/20 flex items-center justify-center mx-auto mb-6">
                        <i data-lucide="mail-check" class="w-10 h-10 text-loot-neon"></i>
                    </div>
                    
                    <h3 class="font-display text-2xl font-bold mb-4">VÃ©rifiez votre email</h3>
                    
                    <p class="text-gray-300 mb-2">
                        Un email de vÃ©rification a Ã©tÃ© envoyÃ© Ã  :
                    </p>
                    <p class="text-loot-neon font-bold mb-6">${email}</p>
                    
                    <div class="bg-loot-card/50 border border-white/10 rounded-xl p-4 mb-6 text-left">
                        <p class="text-sm text-gray-400 mb-2">ðŸ“¬ Instructions :</p>
                        <ol class="text-sm text-gray-300 space-y-1 list-decimal list-inside">
                            <li>Ouvrez votre boÃ®te mail</li>
                            <li>Cherchez l'email de LootQuest</li>
                            <li>Cliquez sur le lien de vÃ©rification</li>
                            <li>Revenez ici et connectez-vous</li>
                        </ol>
                    </div>
                    
                    <button onclick="resendVerificationEmail('${email}')" class="w-full btn-neon py-3 rounded-xl font-bold mb-3">
                        <i data-lucide="send" class="w-4 h-4 inline mr-2"></i>
                        Renvoyer l'email
                    </button>
                    
                    <button onclick="closeModal()" class="text-sm text-gray-400 hover:text-white">
                        Fermer
                    </button>
                </div>
            `;

            openModal('Compte crÃ©Ã© !', content, 'mail', 'text-loot-neon');
        }

        /**
         * Show modal when user tries to login without verifying email
         */
        function showEmailVerificationRequired(email) {
            const content = `
                <div class="text-center py-6">
                    <div class="w-20 h-20 rounded-full bg-red-500/20 flex items-center justify-center mx-auto mb-6">
                        <i data-lucide="shield-alert" class="w-10 h-10 text-red-500"></i>
                    </div>
                    
                    <h3 class="font-display text-2xl font-bold mb-4 text-red-400">Email non vÃ©rifiÃ©</h3>
                    
                    <p class="text-gray-300 mb-6">
                        Vous devez vÃ©rifier votre email avant de pouvoir vous connecter.
                    </p>
                    
                    <p class="text-sm text-gray-400 mb-6">
                        Si vous n'avez pas reÃ§u l'email de vÃ©rification, cliquez sur le bouton ci-dessous.
                    </p>
                    
                    <button onclick="resendVerificationEmail('${email}')" class="w-full btn-neon py-3 rounded-xl font-bold mb-3">
                        <i data-lucide="send" class="w-4 h-4 inline mr-2"></i>
                        Renvoyer l'email de vÃ©rification
                    </button>
                    
                    <button onclick="closeModal()" class="text-sm text-gray-400 hover:text-white">
                        Fermer
                    </button>
                </div>
            `;

            openModal('VÃ©rification requise', content, 'shield-alert', 'text-red-400');
        }

        /**
         * Resend verification email with rate limiting
         */
        let lastVerificationEmailSent = 0;
        const RATE_LIMIT_MS = 60000; // 1 minute

        async function resendVerificationEmail(email) {
            console.log('ðŸ”µ [DEBUG] Resend verification email requested for:', email);

            // Rate limiting
            const now = Date.now();
            if (now - lastVerificationEmailSent < RATE_LIMIT_MS) {
                const remainingSeconds = Math.ceil((RATE_LIMIT_MS - (now - lastVerificationEmailSent)) / 1000);
                showToast(`Veuillez attendre ${remainingSeconds} secondes avant de renvoyer l'email`, 'error');
                return;
            }

            try {
                // We need to sign in the user temporarily to send verification email
                // Prompt for password
                const password = prompt('Entrez votre mot de passe pour renvoyer l\'email de vÃ©rification:');

                if (!password) {
                    showToast('Mot de passe requis', 'error');
                    return;
                }

                console.log('ðŸ”µ [DEBUG] Signing in temporarily...');
                const result = await firebase.auth().signInWithEmailAndPassword(email, password);
                const user = result.user;

                console.log('ðŸ“§ [DEBUG] Sending verification email...');
                await user.sendEmailVerification();

                // Sign out immediately
                await firebase.auth().signOut();

                lastVerificationEmailSent = now;
                console.log('âœ… [SUCCESS] Verification email resent');
                showToast('âœ… Email de vÃ©rification renvoyÃ© !', 'success');

            } catch (error) {
                console.error('âŒ [ERROR] Failed to resend verification email:', error);

                if (error.code === 'auth/wrong-password') {
                    showToast('Mot de passe incorrect', 'error');
                } else if (error.code === 'auth/too-many-requests') {
                    showToast('Trop de tentatives. RÃ©essayez plus tard.', 'error');
                } else {
                    showToast('Erreur lors de l\'envoi de l\'email', 'error');
                }
            }
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // AUTH HANDLERS (Using LootAuth Module)
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        // Opens auth modal when user clicks login buttons on page
        async function loginWithGoogle() {
            openAuthModal();
        }

        async function loginWithDiscord() {
            // Redirect to Discord OAuth2 flow
            LootAuth.loginWithDiscord();
        }

        // Google OAuth handler (from modal button)
        async function handleGoogleLogin() {
            closeAuthModal();
            showToast('Connexion Google en cours...', 'info');

            const result = await LootAuth.loginWithGoogle();

            if (!result.success) {
                showToast(result.error || 'Ã‰chec de la connexion Google', 'error');
            }
        }

        // Discord OAuth handler (from modal button)
        function handleDiscordLogin() {
            closeAuthModal();
            LootAuth.loginWithDiscord();
        }

        // NOTE: handleEmailLogin and handleEmailRegister are defined earlier with dyn-* ID support (lines ~1947-2078)


        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• DASHBOARD â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        function showDashboard() {
            gsap.to("#landing-page", {
                opacity: 0,
                duration: 0.5,
                onComplete: () => {
                    document.getElementById('landing-page').classList.add('hidden');
                    document.getElementById('dashboard').classList.remove('hidden');
                    document.getElementById('user-name-display').innerText = currentUser?.displayName || 'Gamer';
                    document.getElementById('dash-balance').innerText = currentUser?.balance || 0;
                    gsap.from("#dashboard", { opacity: 0, duration: 0.5 });
                    lucide.createIcons();
                }
            });
        }

        function logout() {
            auth.signOut();
            localStorage.removeItem('lootquest_token');
            authToken = null;
            currentUser = null;

            document.getElementById('dashboard').classList.add('hidden');
            document.getElementById('landing-page').classList.remove('hidden');
            document.getElementById('landing-page').style.opacity = 1;

            showToast('Logged out successfully', 'info');
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• TOAST NOTIFICATIONS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        function showToast(message, type = 'info') {
            const container = document.getElementById('toast-container');
            const toast = document.createElement('div');

            const bgColor = type === 'success' ? 'bg-green-500/20 border-green-500/50' :
                type === 'error' ? 'bg-red-500/20 border-red-500/50' :
                    'bg-loot-neon/20 border-loot-neon/50';

            toast.className = `${bgColor} border backdrop-blur-sm px-4 py-3 rounded-xl text-white text-sm`;
            toast.textContent = message;

            container.appendChild(toast);

            gsap.from(toast, { opacity: 0, x: 50, duration: 0.3 });

            setTimeout(() => {
                gsap.to(toast, { opacity: 0, x: 50, duration: 0.3, onComplete: () => toast.remove() });
            }, 3000);
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• GLOBAL CLICK HANDLERS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // (Removed old override for loginWithGoogle buttons)

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• DYNAMIC COPYRIGHT YEAR â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        document.getElementById('copyright-year').textContent = new Date().getFullYear();

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• SERVER STATUS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        async function fetchServerStatus() {
            try {
                const res = await fetch('/api/status');
                const data = await res.json();
                const statusEl = document.getElementById('server-status');
                if (data.status === 'operational') {
                    statusEl.innerHTML = `
                        <span class="w-2 h-2 rounded-full bg-green-500 animate-pulse"></span>
                        <span class="text-gray-400">All Systems Operational</span>
                    `;
                } else {
                    statusEl.innerHTML = `
                        <span class="w-2 h-2 rounded-full bg-yellow-500"></span>
                        <span class="text-gray-400">Partial Outage</span>
                    `;
                }
            } catch (e) {
                console.error('Failed to fetch status');
            }
        }
        fetchServerStatus();

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• LEGAL PAGES â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        let legalPageContainer = null;

        async function loadLegalPage(pageSlug) {
            try {
                const res = await fetch(`/api/legal/${pageSlug}`);
                const data = await res.json();

                if (!data.success) {
                    showToast('Page not found', 'error');
                    return;
                }

                const page = data.page;

                // Create page view
                const html = `
                    <div id="legal-page-view" class="fixed inset-0 z-50 bg-loot-black overflow-auto">
                        <div class="max-w-4xl mx-auto px-6 py-20">
                            <button onclick="closeLegalPage()" class="mb-8 flex items-center gap-2 text-gray-400 hover:text-white transition-colors">
                                <i data-lucide="arrow-left" class="w-5 h-5"></i>
                                Back to Home
                            </button>
                            <h1 class="font-display text-4xl font-bold mb-4">${page.title}</h1>
                            <p class="text-gray-500 text-sm mb-8">Last updated: ${page.lastUpdated}</p>
                            <div class="space-y-8">
                                ${page.sections.map(s => `
                                    <section>
                                        <h2 class="font-display text-xl font-bold text-loot-neon mb-3">${s.title}</h2>
                                        <p class="text-gray-300 whitespace-pre-line leading-relaxed">${s.content}</p>
                                    </section>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                `;

                document.body.insertAdjacentHTML('beforeend', html);
                legalPageContainer = document.getElementById('legal-page-view');
                document.body.style.overflow = 'hidden';
                lucide.createIcons();

            } catch (e) {
                console.error('Failed to load legal page:', e);
                showToast('Failed to load page', 'error');
            }
        }

        function closeLegalPage() {
            if (legalPageContainer) {
                legalPageContainer.remove();
                legalPageContainer = null;
                document.body.style.overflow = '';
            }
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• BLOG â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        let blogPageContainer = null;

        async function loadBlogPage() {
            try {
                const res = await fetch('/api/blog');
                const data = await res.json();

                if (!data.success) {
                    showToast('Failed to load blog', 'error');
                    return;
                }

                const { articles, categories } = data;

                const html = `
                    <div id="blog-page-view" class="fixed inset-0 z-50 bg-loot-black overflow-auto">
                        <div class="max-w-7xl mx-auto px-6 py-20">
                            <button onclick="closeBlogPage()" class="mb-8 flex items-center gap-2 text-gray-400 hover:text-white transition-colors">
                                <i data-lucide="arrow-left" class="w-5 h-5"></i>
                                Back to Home
                            </button>
                            <h1 class="font-display text-4xl font-bold mb-2">LootQuest <span class="text-gradient-primary">Blog</span></h1>
                            <p class="text-gray-400 mb-8">Tips, tutorials, and updates from the LootQuest team.</p>
                            
                            <!-- Categories -->
                            <div class="flex gap-2 mb-8 flex-wrap">
                                ${categories.map(c => `
                                    <button class="px-4 py-2 rounded-full bg-loot-card border border-white/10 text-sm font-medium hover:border-loot-neon transition-colors">
                                        ${c.name}
                                    </button>
                                `).join('')}
                            </div>
                            
                            <!-- Articles Grid -->
                            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                ${articles.map(a => `
                                    <article onclick="loadBlogArticle('${a.slug}')" class="glass-card rounded-2xl overflow-hidden cursor-pointer group">
                                        <div class="h-40 overflow-hidden">
                                            <img src="${a.image}" alt="${a.title}" class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-500">
                                        </div>
                                        <div class="p-5">
                                            <div class="flex items-center gap-2 text-xs text-gray-500 mb-2">
                                                <span class="px-2 py-0.5 bg-loot-purple/20 text-loot-purple rounded-full">${a.category}</span>
                                                <span>${a.readTime}</span>
                                            </div>
                                            <h3 class="font-display font-bold text-lg mb-2 group-hover:text-loot-neon transition-colors">${a.title}</h3>
                                            <p class="text-gray-400 text-sm line-clamp-2">${a.excerpt}</p>
                                        </div>
                                    </article>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                `;

                document.body.insertAdjacentHTML('beforeend', html);
                blogPageContainer = document.getElementById('blog-page-view');
                document.body.style.overflow = 'hidden';
                lucide.createIcons();

            } catch (e) {
                console.error('Failed to load blog:', e);
                showToast('Failed to load blog', 'error');
            }
        }

        async function loadBlogArticle(slug) {
            try {
                const res = await fetch(`/api/blog/${slug}`);
                const data = await res.json();

                if (!data.success) {
                    showToast('Article not found', 'error');
                    return;
                }

                const { article, related } = data;

                // Replace blog view with article view
                closeBlogPage();

                const html = `
                    <div id="blog-page-view" class="fixed inset-0 z-50 bg-loot-black overflow-auto">
                        <div class="max-w-3xl mx-auto px-6 py-20">
                            <button onclick="loadBlogPage()" class="mb-8 flex items-center gap-2 text-gray-400 hover:text-white transition-colors">
                                <i data-lucide="arrow-left" class="w-5 h-5"></i>
                                Back to Blog
                            </button>
                            
                            <!-- Breadcrumb -->
                            <nav class="text-sm text-gray-500 mb-4">
                                <a href="#" onclick="closeBlogPage(); return false;" class="hover:text-loot-neon">Home</a> / 
                                <a href="#" onclick="loadBlogPage(); return false;" class="hover:text-loot-neon">Blog</a> / 
                                <span class="text-gray-400">${article.category}</span>
                            </nav>
                            
                            <h1 class="font-display text-3xl md:text-4xl font-bold mb-4">${article.title}</h1>
                            
                            <div class="flex items-center gap-4 text-sm text-gray-500 mb-8">
                                <span>${article.author}</span>
                                <span>â€¢</span>
                                <span>${article.date}</span>
                                <span>â€¢</span>
                                <span>${article.readTime} read</span>
                            </div>
                            
                            <img src="${article.image}" alt="${article.title}" class="w-full h-64 object-cover rounded-2xl mb-8">
                            
                            <!-- Article Content -->
                            <div class="prose prose-invert max-w-none">
                                ${article.content.map(block => {
                    if (block.type === 'heading') return `<h2 class="font-display text-xl font-bold text-loot-neon mt-8 mb-4">${block.text}</h2>`;
                    if (block.type === 'paragraph') return `<p class="text-gray-300 mb-4 leading-relaxed">${block.text}</p>`;
                    if (block.type === 'warning') return `<div class="p-4 bg-red-500/10 border border-red-500/30 rounded-xl text-red-400 my-4"><strong>âš ï¸ Warning:</strong> ${block.text}</div>`;
                    return '';
                }).join('')}
                            </div>
                            
                            <!-- Tags -->
                            <div class="flex flex-wrap gap-2 mt-8">
                                ${article.tags.map(t => `<span class="px-3 py-1 bg-loot-card rounded-full text-sm text-gray-400">#${t}</span>`).join('')}
                            </div>
                            
                            <!-- Related Articles -->
                            ${related.length > 0 ? `
                                <div class="mt-12 pt-8 border-t border-white/10">
                                    <h3 class="font-display text-xl font-bold mb-4">Related Articles</h3>
                                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                        ${related.map(r => `
                                            <a onclick="loadBlogArticle('${r.slug}')" class="glass-card p-4 rounded-xl cursor-pointer hover:border-loot-neon/30 transition-colors flex items-center gap-3">
                                                <img src="${r.image}" class="w-16 h-16 rounded-lg object-cover">
                                                <span class="text-sm font-medium">${r.title}</span>
                                            </a>
                                        `).join('')}
                                    </div>
                                </div>
                            ` : ''}
                        </div>
                    </div>
                `;

                document.body.insertAdjacentHTML('beforeend', html);
                blogPageContainer = document.getElementById('blog-page-view');
                document.body.style.overflow = 'hidden';
                lucide.createIcons();

            } catch (e) {
                console.error('Failed to load article:', e);
                showToast('Failed to load article', 'error');
            }
        }

        function closeBlogPage() {
            if (blogPageContainer) {
                blogPageContainer.remove();
                blogPageContainer = null;
                document.body.style.overflow = '';
            }
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• BUG REPORT MODAL â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        function openBugReportModal() {
            document.getElementById('bug-report-modal').classList.remove('hidden');
            document.getElementById('bug-report-form').classList.remove('hidden');
            document.getElementById('report-success').classList.add('hidden');
            document.getElementById('bug-report-form').reset();
            document.body.style.overflow = 'hidden';
            lucide.createIcons();
        }

        function closeBugReportModal() {
            document.getElementById('bug-report-modal').classList.add('hidden');
            document.body.style.overflow = '';
        }

        async function submitBugReport(e) {
            e.preventDefault();

            const category = document.getElementById('report-category').value;
            const title = document.getElementById('report-title').value;
            const description = document.getElementById('report-description').value;
            const email = document.getElementById('report-email').value;

            try {
                const res = await fetch('/api/report', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        ...(authToken ? { 'Authorization': `Bearer ${authToken}` } : {})
                    },
                    body: JSON.stringify({
                        category,
                        title,
                        description,
                        email,
                        browserInfo: navigator.userAgent,
                        pageUrl: window.location.href
                    })
                });

                const data = await res.json();

                if (data.success) {
                    document.getElementById('bug-report-form').classList.add('hidden');
                    document.getElementById('report-success').classList.remove('hidden');
                    lucide.createIcons();
                } else {
                    showToast(data.error || 'Failed to submit report', 'error');
                }
            } catch (error) {
                console.error('Bug report error:', error);
                showToast('Failed to submit report', 'error');
            }
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• ADMIN PANEL â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        let adminKey = localStorage.getItem('lootquest_admin_key') || '';

        function openAdminPanel() {
            if (!adminKey) {
                adminKey = prompt('Enter Admin Key:');
                if (adminKey) {
                    localStorage.setItem('lootquest_admin_key', adminKey);
                } else {
                    return;
                }
            }

            document.getElementById('admin-panel').classList.remove('hidden');
            document.body.style.overflow = 'hidden';
            loadAdminStats();
            loadAdminReports('all');
            lucide.createIcons();
        }

        function closeAdminPanel() {
            document.getElementById('admin-panel').classList.add('hidden');
            document.body.style.overflow = '';
        }

        async function loadAdminStats() {
            try {
                const res = await fetch('/api/admin/stats', {
                    headers: { 'X-Admin-Key': adminKey }
                });
                const data = await res.json();

                if (!data.success) {
                    showToast('Admin access denied', 'error');
                    localStorage.removeItem('lootquest_admin_key');
                    adminKey = '';
                    closeAdminPanel();
                    return;
                }

                const { stats } = data;
                document.getElementById('admin-stats').innerHTML = `
                    <div class="glass-card p-4 rounded-xl">
                        <div class="text-2xl font-bold text-loot-neon">${stats.users.total}</div>
                        <div class="text-sm text-gray-400">Total Users</div>
                    </div>
                    <div class="glass-card p-4 rounded-xl">
                        <div class="text-2xl font-bold text-loot-purple">${stats.withdrawals.pending}</div>
                        <div class="text-sm text-gray-400">Pending Withdrawals</div>
                    </div>
                    <div class="glass-card p-4 rounded-xl">
                        <div class="text-2xl font-bold text-red-500">${stats.bugReports.new}</div>
                        <div class="text-sm text-gray-400">New Bug Reports</div>
                    </div>
                    <div class="glass-card p-4 rounded-xl">
                        <div class="text-2xl font-bold text-green-500">${stats.bugReports.total}</div>
                        <div class="text-sm text-gray-400">Total Reports</div>
                    </div>
                `;
            } catch (error) {
                console.error('Failed to load admin stats:', error);
            }
        }

        async function loadAdminReports(status) {
            // Update tab styles
            document.querySelectorAll('.admin-tab').forEach(tab => {
                tab.classList.remove('bg-loot-purple', 'text-white', 'active');
                tab.classList.add('bg-loot-card', 'text-gray-400');
            });
            event.target.classList.add('bg-loot-purple', 'text-white', 'active');
            event.target.classList.remove('bg-loot-card', 'text-gray-400');

            try {
                const res = await fetch(`/api/admin/reports?status=${status}`, {
                    headers: { 'X-Admin-Key': adminKey }
                });
                const data = await res.json();

                if (!data.success) return;

                const statusBadge = (s) => {
                    const colors = {
                        new: 'bg-blue-500/20 text-blue-400',
                        in_progress: 'bg-yellow-500/20 text-yellow-400',
                        resolved: 'bg-green-500/20 text-green-400',
                        wont_fix: 'bg-gray-500/20 text-gray-400'
                    };
                    return `<span class="px-2 py-1 rounded-full text-xs ${colors[s] || colors.new}">${s.replace('_', ' ')}</span>`;
                };

                document.getElementById('admin-reports-table').innerHTML = data.reports.length === 0
                    ? '<tr><td colspan="7" class="px-6 py-8 text-center text-gray-500">No reports found</td></tr>'
                    : data.reports.map(r => `
                        <tr class="border-b border-white/5 hover:bg-white/5">
                            <td class="px-6 py-4 text-sm">#${r.id}</td>
                            <td class="px-6 py-4 text-sm">${r.category}</td>
                            <td class="px-6 py-4 text-sm max-w-xs truncate">${r.title}</td>
                            <td class="px-6 py-4 text-sm text-gray-400">${r.user_email || 'Anonymous'}</td>
                            <td class="px-6 py-4">${statusBadge(r.status)}</td>
                            <td class="px-6 py-4 text-sm text-gray-400">${new Date(r.created_at).toLocaleDateString()}</td>
                            <td class="px-6 py-4">
                                <select onchange="updateReportStatus(${r.id}, this.value)" class="bg-loot-card border border-white/10 rounded px-2 py-1 text-sm">
                                    <option value="new" ${r.status === 'new' ? 'selected' : ''}>New</option>
                                    <option value="in_progress" ${r.status === 'in_progress' ? 'selected' : ''}>In Progress</option>
                                    <option value="resolved" ${r.status === 'resolved' ? 'selected' : ''}>Resolved</option>
                                    <option value="wont_fix" ${r.status === 'wont_fix' ? 'selected' : ''}>Won't Fix</option>
                                </select>
                            </td>
                        </tr>
                    `).join('');
            } catch (error) {
                console.error('Failed to load reports:', error);
            }
        }

        async function updateReportStatus(id, status) {
            try {
                const res = await fetch(`/api/admin/reports/${id}`, {
                    method: 'PATCH',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Admin-Key': adminKey
                    },
                    body: JSON.stringify({ status })
                });

                const data = await res.json();
                if (data.success) {
                    showToast(`Report #${id} updated to ${status}`, 'success');
                    loadAdminStats();
                }
            } catch (error) {
                console.error('Failed to update report:', error);
                showToast('Failed to update report', 'error');
            }
        }

        // Secret admin access: press Ctrl+Shift+A
        document.addEventListener('keydown', (e) => {
            if (e.ctrlKey && e.shiftKey && e.key === 'A') {
                e.preventDefault();
                openAdminPanel();
            }
        });

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• DYNAMIC MODAL ENGINE â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        const modalEl = document.getElementById('dynamic-modal');
        const modalBackdrop = document.getElementById('modal-backdrop');
        const modalTitle = document.getElementById('modal-title');
        const modalIcon = document.getElementById('modal-icon');
        const modalBody = document.getElementById('modal-body');

        // Open Modal with animation
        function openModal(title, content, icon = 'info', iconColor = 'text-loot-neon') {
            modalTitle.textContent = title;
            modalBody.innerHTML = content;
            modalIcon.innerHTML = `<i data-lucide="${icon}" class="w-5 h-5 ${iconColor}"></i>`;

            modalEl.classList.remove('hidden');
            document.body.style.overflow = 'hidden';

            // Trigger animation
            requestAnimationFrame(() => {
                modalEl.classList.add('active');
            });

            lucide.createIcons();
        }

        // Close Modal with animation
        function closeModal() {
            modalEl.classList.remove('active');

            setTimeout(() => {
                modalEl.classList.add('hidden');
                document.body.style.overflow = '';
                modalBody.innerHTML = '';
            }, 300);
        }

        // Close on backdrop click
        modalBackdrop.addEventListener('click', closeModal);

        // Close on Escape
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && !modalEl.classList.contains('hidden')) {
                closeModal();
            }
        });

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• LEGAL MODALS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        async function openLegalModal(type) {
            const titles = {
                'terms-of-service': 'Terms of Service',
                'privacy-policy': 'Privacy Policy',
                'cookie-policy': 'Cookie Policy',
                'faq': 'Frequently Asked Questions'
            };
            const icons = {
                'terms-of-service': 'file-text',
                'privacy-policy': 'shield',
                'cookie-policy': 'cookie',
                'faq': 'help-circle'
            };

            // Show loading
            openModal(titles[type] || 'Legal', '<div class="flex items-center justify-center py-12"><div class="animate-spin w-8 h-8 border-2 border-loot-neon border-t-transparent rounded-full"></div></div>', icons[type] || 'file-text');

            try {
                const res = await fetch(`/api/legal/${type}`);
                const data = await res.json();

                if (data.success && data.content) {
                    let html = `<div class="legal-content">`;
                    html += `<p class="text-sm text-gray-500 mb-4">Last updated: ${data.content.lastUpdated || 'N/A'}</p>`;

                    data.content.sections.forEach(section => {
                        html += `<h3>${section.title}</h3>`;
                        section.paragraphs.forEach(p => {
                            if (p.startsWith('âš ï¸') || p.startsWith('WARNING')) {
                                html += `<div class="warning-box"><p>${p}</p></div>`;
                            } else {
                                html += `<p>${p}</p>`;
                            }
                        });
                    });

                    html += `</div>`;
                    modalBody.innerHTML = html;
                } else {
                    modalBody.innerHTML = '<p class="text-red-400">Failed to load content.</p>';
                }
            } catch (error) {
                console.error('Failed to load legal content:', error);
                modalBody.innerHTML = '<p class="text-red-400">Failed to load content.</p>';
            }
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• BUG REPORT MODAL â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        function openBugModal() {
            const content = `
                <form id="bug-form" class="space-y-4">
                    <div>
                        <label class="block text-sm text-gray-400 mb-2">Subject *</label>
                        <input type="text" id="bug-subject" required minlength="5" maxlength="200"
                            class="w-full bg-loot-card border border-white/10 rounded-xl px-4 py-3 text-white placeholder-gray-500 focus:outline-none focus:border-loot-neon transition-colors"
                            placeholder="Brief description of the issue">
                    </div>
                    
                    <div>
                        <label class="block text-sm text-gray-400 mb-2">Description *</label>
                        <textarea id="bug-content" required minlength="20" maxlength="5000" rows="5"
                            class="w-full bg-loot-card border border-white/10 rounded-xl px-4 py-3 text-white placeholder-gray-500 focus:outline-none focus:border-loot-neon transition-colors resize-none"
                            placeholder="Describe the bug in detail. Include steps to reproduce, expected behavior, and what actually happened..."></textarea>
                    </div>
                    
                    <div>
                        <label class="block text-sm text-gray-400 mb-2">Your Email (optional)</label>
                        <input type="email" id="bug-email"
                            class="w-full bg-loot-card border border-white/10 rounded-xl px-4 py-3 text-white placeholder-gray-500 focus:outline-none focus:border-loot-neon transition-colors"
                            placeholder="For follow-up questions">
                    </div>
                    
                    <button type="submit" class="w-full btn-glow py-3 rounded-xl font-bold text-lg flex items-center justify-center gap-2">
                        <i data-lucide="send" class="w-5 h-5"></i>
                        Send Bug Report
                    </button>
                </form>
            `;

            openModal('Report a Bug', content, 'bug', 'text-red-400');

            document.getElementById('bug-form').addEventListener('submit', submitBugForm);
        }

        async function submitBugForm(e) {
            e.preventDefault();

            const subject = document.getElementById('bug-subject').value;
            const content = document.getElementById('bug-content').value;
            const email = document.getElementById('bug-email').value;

            try {
                const res = await fetch('/api/support/bug', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        ...(authToken ? { 'Authorization': `Bearer ${authToken}` } : {})
                    },
                    body: JSON.stringify({
                        subject,
                        content,
                        email,
                        browserInfo: navigator.userAgent,
                        pageUrl: window.location.href
                    })
                });

                const data = await res.json();

                if (data.success) {
                    modalBody.innerHTML = `
                        <div class="text-center py-8">
                            <div class="w-16 h-16 rounded-full bg-green-500/20 flex items-center justify-center mx-auto mb-4">
                                <i data-lucide="check-circle" class="w-8 h-8 text-green-500"></i>
                            </div>
                            <h3 class="font-display text-xl font-bold mb-2">Thank You!</h3>
                            <p class="text-gray-400 mb-2">${data.message}</p>
                            <p class="text-sm text-gray-500">Ticket #${data.ticketId}</p>
                        </div>
                    `;
                    lucide.createIcons();
                } else {
                    showToast(data.error || 'Failed to submit', 'error');
                }
            } catch (error) {
                console.error('Bug report error:', error);
                showToast('Failed to submit bug report', 'error');
            }
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• CONTACT MODAL â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        function openContactModal() {
            const content = `
                <form id="contact-form" class="space-y-4">
                    <div>
                        <label class="block text-sm text-gray-400 mb-2">Your Email *</label>
                        <input type="email" id="contact-email" required
                            class="w-full bg-loot-card border border-white/10 rounded-xl px-4 py-3 text-white placeholder-gray-500 focus:outline-none focus:border-loot-neon transition-colors"
                            placeholder="your@email.com">
                    </div>
                    
                    <div>
                        <label class="block text-sm text-gray-400 mb-2">Subject *</label>
                        <input type="text" id="contact-subject" required minlength="3" maxlength="200"
                            class="w-full bg-loot-card border border-white/10 rounded-xl px-4 py-3 text-white placeholder-gray-500 focus:outline-none focus:border-loot-neon transition-colors"
                            placeholder="How can we help?">
                    </div>
                    
                    <div>
                        <label class="block text-sm text-gray-400 mb-2">Message *</label>
                        <textarea id="contact-content" required minlength="10" maxlength="5000" rows="5"
                            class="w-full bg-loot-card border border-white/10 rounded-xl px-4 py-3 text-white placeholder-gray-500 focus:outline-none focus:border-loot-neon transition-colors resize-none"
                            placeholder="Write your message here..."></textarea>
                    </div>
                    
                    <button type="submit" class="w-full btn-glow py-3 rounded-xl font-bold text-lg flex items-center justify-center gap-2">
                        <i data-lucide="mail" class="w-5 h-5"></i>
                        Send Message
                    </button>
                </form>
            `;

            openModal('Contact Us', content, 'mail', 'text-loot-neon');

            document.getElementById('contact-form').addEventListener('submit', submitContactForm);
        }

        async function submitContactForm(e) {
            e.preventDefault();

            const email = document.getElementById('contact-email').value;
            const subject = document.getElementById('contact-subject').value;
            const content = document.getElementById('contact-content').value;

            try {
                const res = await fetch('/api/support/contact', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        ...(authToken ? { 'Authorization': `Bearer ${authToken}` } : {})
                    },
                    body: JSON.stringify({ email, subject, content })
                });

                const data = await res.json();

                if (data.success) {
                    modalBody.innerHTML = `
                        <div class="text-center py-8">
                            <div class="w-16 h-16 rounded-full bg-loot-neon/20 flex items-center justify-center mx-auto mb-4">
                                <i data-lucide="check-circle" class="w-8 h-8 text-loot-neon"></i>
                            </div>
                            <h3 class="font-display text-xl font-bold mb-2">Message Sent!</h3>
                            <p class="text-gray-400 mb-2">${data.message}</p>
                            <p class="text-sm text-gray-500">Ticket #${data.ticketId}</p>
                        </div>
                    `;
                    lucide.createIcons();
                } else {
                    showToast(data.error || 'Failed to send', 'error');
                }
            } catch (error) {
                console.error('Contact form error:', error);
                showToast('Failed to send message', 'error');
            }
        }

    </script>

    <!-- Toast Container -->
    <div id="toast-container" class="fixed bottom-4 right-4 z-50 space-y-2"></div>
</body>

</html>