<!DOCTYPE html>
<html lang="en" class="scroll-smooth">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Verify your email to access LootQuest - The #1 Platform for gaming rewards">
    <title>Verify Your Email | LootQuest</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Space+Grotesk:wght@500;700;800&display=swap"
        rel="stylesheet">

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        loot: {
                            black: '#050505',
                            dark: '#0a0a0a',
                            card: '#121212',
                            neon: '#00f3ff',
                            purple: '#bc13fe',
                            gold: '#ffd700',
                            text: '#e0e0e0',
                            dim: '#6b7280'
                        }
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        display: ['Space Grotesk', 'sans-serif'],
                    }
                }
            }
        }
    </script>

    <style>
        body {
            background-color: #050505;
            color: #e0e0e0;
        }

        .glass-card {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.03) 0%, rgba(255, 255, 255, 0.01) 100%);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.08);
        }

        .text-gradient-primary {
            background: linear-gradient(135deg, #00f3ff 0%, #bc13fe 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .btn-neon {
            position: relative;
            background: transparent;
            color: #00f3ff;
            border: 1px solid #00f3ff;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .btn-neon:hover {
            background: rgba(0, 243, 255, 0.1);
            box-shadow: 0 0 20px rgba(0, 243, 255, 0.4);
            text-shadow: 0 0 8px rgba(0, 243, 255, 0.6);
        }

        .btn-neon:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-glow {
            background: linear-gradient(135deg, #00f3ff 0%, #bc13fe 100%);
            color: white;
            position: relative;
            z-index: 1;
        }

        .btn-glow::after {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: linear-gradient(135deg, #00f3ff 0%, #bc13fe 100%);
            z-index: -1;
            filter: blur(15px);
            opacity: 0.5;
            border-radius: inherit;
        }

        /* Floating animation */
        @keyframes float {

            0%,
            100% {
                transform: translateY(0px);
            }

            50% {
                transform: translateY(-10px);
            }
        }

        .animate-float {
            animation: float 4s ease-in-out infinite;
        }

        /* Background grid pattern */
        .grid-bg {
            background-image: linear-gradient(to right, #1f1f1f 1px, transparent 1px),
                linear-gradient(to bottom, #1f1f1f 1px, transparent 1px);
            background-size: 40px 40px;
            mask-image: radial-gradient(ellipse at center, black 30%, transparent 70%);
        }
    </style>
</head>

<body class="antialiased min-h-screen flex items-center justify-center p-6 relative overflow-hidden">

    <!-- Background Elements -->
    <div class="fixed inset-0 z-[-1]">
        <div class="absolute inset-0 grid-bg opacity-20"></div>
        <div
            class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[600px] h-[600px] bg-loot-purple/10 rounded-full blur-3xl">
        </div>
        <div class="absolute top-1/4 right-1/4 w-[300px] h-[300px] bg-loot-neon/5 rounded-full blur-3xl"></div>
    </div>

    <!-- Main Content -->
    <div class="glass-card max-w-md w-full p-8 rounded-3xl relative">

        <!-- Logo -->
        <a href="/" class="flex items-center justify-center gap-2 mb-8 group">
            <i data-lucide="gamepad-2" class="w-8 h-8 text-loot-neon group-hover:rotate-12 transition-transform"></i>
            <span class="font-display text-2xl font-bold tracking-tighter">
                LOOT<span class="text-gradient-primary">QUEST</span>
            </span>
        </a>

        <!-- Icon -->
        <div class="w-24 h-24 rounded-full bg-loot-neon/20 flex items-center justify-center mx-auto mb-6 animate-float">
            <i data-lucide="mail-check" class="w-12 h-12 text-loot-neon"></i>
        </div>

        <!-- Title -->
        <h1 class="font-display text-3xl font-bold text-center mb-4">
            Vérifiez votre email
        </h1>

        <!-- Description -->
        <p class="text-gray-400 text-center mb-6">
            Un email de vérification a été envoyé à votre adresse.
            Cliquez sur le lien pour activer votre compte.
        </p>

        <!-- Email Display (if available) -->
        <div id="email-display" class="hidden text-center mb-6">
            <p class="text-sm text-gray-500 mb-1">Email envoyé à :</p>
            <p id="email-address" class="text-loot-neon font-bold"></p>
        </div>

        <!-- Instructions Box -->
        <div class="bg-loot-card/50 border border-white/10 rounded-xl p-5 mb-6">
            <p class="text-sm text-gray-400 mb-3 flex items-center gap-2">
                <i data-lucide="list-checks" class="w-4 h-4"></i>
                Instructions :
            </p>
            <ol class="text-sm text-gray-300 space-y-2 list-decimal list-inside">
                <li>Ouvrez votre boîte mail</li>
                <li>Cherchez l'email de <span class="text-loot-neon">LootQuest</span></li>
                <li>Cliquez sur le lien de vérification</li>
                <li>Revenez ici et connectez-vous</li>
            </ol>
        </div>

        <!-- Actions -->
        <div class="space-y-3">
            <!-- Resend Button -->
            <button id="resend-btn" onclick="showResendModal()"
                class="w-full btn-neon py-3 rounded-xl font-bold flex items-center justify-center gap-2">
                <i data-lucide="send" class="w-5 h-5"></i>
                Renvoyer l'email
            </button>

            <!-- Back to Login -->
            <a href="/" class="w-full btn-glow py-3 rounded-xl font-bold flex items-center justify-center gap-2">
                <i data-lucide="log-in" class="w-5 h-5"></i>
                Retour à la connexion
            </a>
        </div>

        <!-- Spam Notice -->
        <p class="text-xs text-gray-600 text-center mt-6">
            <i data-lucide="alert-circle" class="w-3 h-3 inline mr-1"></i>
            Pas reçu l'email ? Vérifiez votre dossier spam.
        </p>
    </div>

    <!-- Resend Modal -->
    <div id="resend-modal" class="fixed inset-0 z-50 hidden">
        <div class="absolute inset-0 bg-black/80 backdrop-blur-sm" onclick="closeResendModal()"></div>
        <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-full max-w-md p-4">
            <div class="glass-card rounded-2xl p-6 border border-white/10">
                <button onclick="closeResendModal()" class="absolute top-4 right-4 text-gray-500 hover:text-white">
                    <i data-lucide="x" class="w-5 h-5"></i>
                </button>

                <h3 class="font-display text-xl font-bold mb-4">Renvoyer l'email</h3>
                <p class="text-sm text-gray-400 mb-4">
                    Entrez vos identifiants pour renvoyer l'email de vérification.
                </p>

                <form id="resend-form" onsubmit="handleResend(event)" class="space-y-4">
                    <div>
                        <label class="block text-sm text-gray-400 mb-1">Email</label>
                        <input type="email" id="resend-email" required
                            class="w-full bg-loot-card border border-white/10 rounded-xl px-4 py-3 text-white placeholder-gray-500 focus:outline-none focus:border-loot-neon transition-colors"
                            placeholder="votre@email.com">
                    </div>
                    <div>
                        <label class="block text-sm text-gray-400 mb-1">Mot de passe</label>
                        <input type="password" id="resend-password" required
                            class="w-full bg-loot-card border border-white/10 rounded-xl px-4 py-3 text-white placeholder-gray-500 focus:outline-none focus:border-loot-neon transition-colors"
                            placeholder="••••••••">
                    </div>
                    <button type="submit" id="resend-submit-btn"
                        class="w-full btn-glow py-3 rounded-xl font-bold flex items-center justify-center gap-2">
                        <i data-lucide="send" class="w-5 h-5"></i>
                        Renvoyer
                    </button>
                </form>

                <!-- Error Display -->
                <div id="resend-error"
                    class="hidden mt-4 p-3 bg-red-500/20 border border-red-500/50 rounded-xl text-red-400 text-sm text-center">
                </div>

                <!-- Success Display -->
                <div id="resend-success"
                    class="hidden mt-4 p-3 bg-green-500/20 border border-green-500/50 rounded-xl text-green-400 text-sm text-center">
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div id="toast-container" class="fixed bottom-4 right-4 z-50 space-y-2"></div>

    <script>
        // ═══════════════════════════════════════════════════════════════════════════
        // FIREBASE INITIALIZATION
        // ═══════════════════════════════════════════════════════════════════════════

        const firebaseConfig = {
            apiKey: "AIzaSyAP5hn_N4lBR7R67abGNkMO_HUhJ8Umnhk",
            authDomain: "loot-quest.fr",
            projectId: "loot-quest-5fe77",
            storageBucket: "loot-quest-5fe77.firebasestorage.app",
            messagingSenderId: "315092498498",
            appId: "1:315092498498:web:a4c69c9d04b306f9cb3f64"
        };

        firebase.initializeApp(firebaseConfig);

        // Initialize Lucide icons
        document.addEventListener('DOMContentLoaded', () => {
            lucide.createIcons();

            // Check for email in URL params (passed from registration)
            const urlParams = new URLSearchParams(window.location.search);
            const email = urlParams.get('email');
            if (email) {
                document.getElementById('email-display').classList.remove('hidden');
                document.getElementById('email-address').textContent = email;
                document.getElementById('resend-email').value = email;
            }
        });

        // ═══════════════════════════════════════════════════════════════════════════
        // RESEND MODAL FUNCTIONS
        // ═══════════════════════════════════════════════════════════════════════════

        function showResendModal() {
            document.getElementById('resend-modal').classList.remove('hidden');
            document.getElementById('resend-error').classList.add('hidden');
            document.getElementById('resend-success').classList.add('hidden');
        }

        function closeResendModal() {
            document.getElementById('resend-modal').classList.add('hidden');
        }

        // Rate limiting
        let lastResendTime = 0;
        const RATE_LIMIT_MS = 60000; // 1 minute

        async function handleResend(event) {
            event.preventDefault();

            const email = document.getElementById('resend-email').value;
            const password = document.getElementById('resend-password').value;
            const submitBtn = document.getElementById('resend-submit-btn');
            const errorDiv = document.getElementById('resend-error');
            const successDiv = document.getElementById('resend-success');

            // Rate limiting check
            const now = Date.now();
            if (now - lastResendTime < RATE_LIMIT_MS) {
                const remaining = Math.ceil((RATE_LIMIT_MS - (now - lastResendTime)) / 1000);
                errorDiv.textContent = `Veuillez attendre ${remaining} secondes avant de réessayer.`;
                errorDiv.classList.remove('hidden');
                successDiv.classList.add('hidden');
                return;
            }

            // Disable button
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<i data-lucide="loader-2" class="w-5 h-5 animate-spin"></i> Envoi...';
            lucide.createIcons();

            errorDiv.classList.add('hidden');
            successDiv.classList.add('hidden');

            try {
                // Sign in temporarily
                const result = await firebase.auth().signInWithEmailAndPassword(email, password);
                const user = result.user;

                // Check if already verified
                if (user.emailVerified) {
                    successDiv.textContent = '✅ Votre email est déjà vérifié ! Vous pouvez vous connecter.';
                    successDiv.classList.remove('hidden');
                    await firebase.auth().signOut();
                    setTimeout(() => {
                        window.location.href = '/';
                    }, 2000);
                    return;
                }

                // Send verification email
                await user.sendEmailVerification();

                // Sign out
                await firebase.auth().signOut();

                // Update rate limit
                lastResendTime = now;

                // Show success
                successDiv.textContent = '✅ Email de vérification envoyé avec succès !';
                successDiv.classList.remove('hidden');

                console.log('✅ Verification email resent to:', email);

            } catch (error) {
                console.error('❌ Resend error:', error);

                let errorMessage = error.message;
                if (error.code === 'auth/wrong-password') {
                    errorMessage = 'Mot de passe incorrect';
                } else if (error.code === 'auth/user-not-found') {
                    errorMessage = 'Aucun compte trouvé avec cet email';
                } else if (error.code === 'auth/too-many-requests') {
                    errorMessage = 'Trop de tentatives. Réessayez plus tard.';
                } else if (error.code === 'auth/invalid-email') {
                    errorMessage = 'Email invalide';
                }

                errorDiv.textContent = errorMessage;
                errorDiv.classList.remove('hidden');
            } finally {
                // Re-enable button
                submitBtn.disabled = false;
                submitBtn.innerHTML = '<i data-lucide="send" class="w-5 h-5"></i> Renvoyer';
                lucide.createIcons();
            }
        }

        // ═══════════════════════════════════════════════════════════════════════════
        // TOAST NOTIFICATIONS
        // ═══════════════════════════════════════════════════════════════════════════

        function showToast(message, type = 'info') {
            const container = document.getElementById('toast-container');
            const toast = document.createElement('div');

            const bgColor = type === 'success' ? 'bg-green-500/20 border-green-500/50' :
                type === 'error' ? 'bg-red-500/20 border-red-500/50' :
                    'bg-loot-neon/20 border-loot-neon/50';

            toast.className = `${bgColor} border backdrop-blur-sm px-4 py-3 rounded-xl text-white text-sm transform translate-x-full transition-transform duration-300`;
            toast.textContent = message;

            container.appendChild(toast);

            // Animate in
            setTimeout(() => {
                toast.classList.remove('translate-x-full');
            }, 10);

            // Remove after 3s
            setTimeout(() => {
                toast.classList.add('translate-x-full');
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }
    </script>

</body>

</html>